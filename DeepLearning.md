# åŸºç¡€

## 1. pytorchåŸºç¡€

### 1.1éšè—å±‚ç”¨Sequentialçš„å®šä¹‰æ–¹å¼ï¼ˆæ›´ç®€å•ï¼‰

![image-20250119140506560](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250119140506560.png)

**å¦ä¸€ç§**æ–¹å¼

![image-20250119151647640](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250119151647640.png)



### 1.2ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯å¯ä»¥è¢«çœ‹ä½œè¡¡é‡ä»–ä»¬å¯¹é½ç¨‹åº¦çš„æ–¹æ³•

![image-20250209135000556](../AppData/Roaming/Typora/typora-user-images/image-20250209135000556.png)

é«˜ç»´å‘é‡çš„æ–¹å‘å¯¹åº”äº†è¯­ä¹‰

### 1.3Transformerçš„ç›®æ ‡æ˜¯å°†è¿™äº›å‘é‡ä¸ä»…ä»…ç¼–ç å•ä¸ªè¯ï¼Œè¿˜è¦èåˆä¸Šä¸‹æ–‡è¯­æ„

### 1.4logitsåˆ†æ•°

åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œlogits åˆ†æ•°æ˜¯æŒ‡æ¨¡å‹è¾“å‡ºå±‚çš„åŸå§‹æœªç»å¤„ç†çš„åˆ†æ•°æˆ–å¾—åˆ†ã€‚è¿™ä¸ªæ¦‚å¿µä¸»è¦ç”¨äºç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ç”¨äºåˆ†ç±»ä»»åŠ¡çš„æ¨¡å‹ã€‚Logits ä»£è¡¨äº†æ¨¡å‹å¯¹æ¯ä¸ªç±»åˆ«çš„çº¿æ€§è¾“å‡ºï¼Œå®ƒä»¬æ˜¯æœªç»è¿‡ä»»ä½•æ¿€æ´»å‡½æ•°å¤„ç†çš„é¢„æµ‹å€¼

å…·ä½“æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªåˆ†ç±»é—®é¢˜ä¸­ï¼Œlogits æ˜¯æ¨¡å‹æœ€åä¸€å±‚å…¨è¿æ¥å±‚çš„è¾“å‡ºï¼Œé€šå¸¸æ˜¯æ²¡æœ‰ç»è¿‡ softmax æˆ–è€… sigmoid æ¿€æ´»å‡½æ•°çš„ç›´æ¥æ•°å€¼ã€‚è¿™äº›æ•°å€¼å¯ä»¥æ˜¯ä»»æ„å®æ•°ï¼Œå¹¶ä¸ä»£è¡¨æ¦‚ç‡ã€‚æ­£å€¼è¡¨ç¤ºè¶‹å‘äºå°†æ ·æœ¬åˆ†ç±»åˆ°å¯¹åº”çš„ç±»åˆ«ï¼Œè€Œè´Ÿå€¼åˆ™è¡¨ç¤ºä¸å€¾å‘äºå°†å…¶åˆ†ç±»åˆ°è¯¥ç±»åˆ«ã€‚å› æ­¤ï¼Œlogits å¯ä»¥çœ‹ä½œæ˜¯å¯¹æ¯ä¸ªç±»åˆ«çš„ç½®ä¿¡åº¦æˆ–è€…è¯´æ˜¯ä¿¡å¿ƒåº¦é‡ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥çš„æ¦‚ç‡

ä¾‹å¦‚ï¼Œåœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œå¦‚æœæ¨¡å‹çš„æœ€åä¸€å±‚è¾“å‡ºä¸ºå•ä¸ªèŠ‚ç‚¹ä¸”æ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œåˆ™è¾“å‡ºå€¼å¦‚ 2.5 å°±æ˜¯è¯¥æ ·æœ¬è¢«é¢„æµ‹ä¸ºæ­£ç±»çš„ logits å€¼ã€‚å¯¹äºå¤šåˆ†ç±»é—®é¢˜ï¼Œæ¨¡å‹çš„æœ€åä¸€å±‚å¯èƒ½æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªç±»åˆ«ã€‚å‡è®¾ä¸€ä¸ªå¤šåˆ†ç±»æ¨¡å‹çš„è¾“å‡ºå±‚åŒ…å«äº”ä¸ªèŠ‚ç‚¹ï¼Œå…¶è¾“å‡ºå‘é‡ä¸º [1.2, 3.1, -0.5, 4.8, 2.3]ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘é‡å°±æ˜¯è¯¥æ ·æœ¬å±äºäº”ä¸ªç±»åˆ«çš„ logits å€¼

ä¸ºäº†å°†è¿™äº› logits è½¬æ¢æˆæ›´æ˜“äºè§£é‡Šçš„å½¢å¼ï¼Œé€šå¸¸ä¼šåº”ç”¨ softmax å‡½æ•°ï¼ˆå¯¹äºå¤šåˆ†ç±»é—®é¢˜ï¼‰æˆ– sigmoid å‡½æ•°ï¼ˆå¯¹äºäºŒåˆ†ç±»é—®é¢˜ï¼‰ã€‚Softmax å‡½æ•°èƒ½å¤Ÿå°† logits è½¬æ¢ä¸ºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—æ¯ä¸ªç±»åˆ«çš„å¾—åˆ†éƒ½åœ¨ 0 åˆ° 1 ä¹‹é—´ï¼Œä¸”æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡ä¹‹å’Œä¸º 1ã€‚è¿™æ ·è½¬æ¢åçš„è¾“å‡ºå°±å¯ä»¥è¢«è§£é‡Šä¸ºæ¨¡å‹å¯¹æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡

æ­¤å¤–ï¼Œåœ¨è®¡ç®—äº¤å‰ç†µæŸå¤±æ—¶ï¼Œlogits ä¹Ÿæ˜¯å…³é”®çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œåœ¨ PyTorch ä¸­ï¼ŒBCEWithLogitsLoss å‡½æ•°å¯ä»¥ç›´æ¥æ¥å— logits ä½œä¸ºè¾“å…¥ï¼Œå¹¶è‡ªåŠ¨å¯¹å…¶è¿›è¡Œ sigmoid å¤„ç†æ¥è®¡ç®—æŸå¤±ï¼›è€Œåœ¨ä½¿ç”¨ BCELoss å‡½æ•°æ—¶ï¼Œåˆ™éœ€è¦å…ˆæ‰‹åŠ¨å¯¹ logits åº”ç”¨ sigmoid å‡½æ•°ï¼Œç„¶åæ‰è®¡ç®—æŸå¤±

æ€»ä¹‹ï¼Œlogits åœ¨æ·±åº¦å­¦ä¹ ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†æ¯ä¸ªç±»åˆ«çš„åŸå§‹å¾—åˆ†ä¿¡æ¯ï¼Œä¸ºåç»­çš„åˆ†ç±»å†³ç­–è¿‡ç¨‹å¥ å®šäº†åŸºç¡€ã€‚ç†è§£ logits çš„å«ä¹‰åŠå…¶ä¸æ¿€æ´»å‡½æ•°çš„å…³ç³»å¯¹äºæ­£ç¡®è®¾è®¡å’Œè®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹è‡³å…³é‡è¦ã€‚åŒæ—¶ï¼Œlogits ä¹Ÿå¸¸ç”¨äºç”Ÿæˆæ¨¡å‹ä¸­ï¼Œæ¯”å¦‚åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„ç”Ÿæˆ/æ¨ç†è¿‡ç¨‹ä¸­ï¼Œlogits å¯¹åº”çš„æ˜¯æ¨¡å‹æœ€åè¾“å‡ºçš„ä¸€ä¸ªå¼ é‡ï¼Œå®ƒåŒ…å«äº†æ¯ä¸ªæ—¶é—´æ­¥é•¿ä¸Šè¯æ±‡è¡¨ä¸­æ¯ä¸ªè¯çš„æ¦‚ç‡åˆ†å¸ƒ

ã€‚è¿™ç§åˆ†å¸ƒéšåå¯èƒ½ä¼šé€šè¿‡é‡‡æ ·æ–¹æ³•ï¼ˆå¦‚ top-k é‡‡æ ·æˆ– nucleus samplingï¼‰æ¥é€‰æ‹©ä¸‹ä¸€ä¸ªè¯ï¼Œä»è€Œç»§ç»­æ–‡æœ¬çš„ç”Ÿæˆè¿‡ç¨‹ã€‚



### 1.5å¯¹çŸ©é˜µç‚¹ç§¯çš„æ›´å¥½ç†è§£

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼è®©æˆ‘ä»¬é€šè¿‡åˆ†è§£çŸ©é˜µè¿ç®—çš„ç»´åº¦æ¥è¯¦ç»†ç†è§£è¿™ä¸ªæ¢¯åº¦è®¡ç®—è¿‡ç¨‹ã€‚é¦–å…ˆæ˜ç¡®å‡ ä¸ªå…³é”®ç»´åº¦ï¼š

å‡è®¾ï¼š

- è¾“å…¥æ•°æ®ç»´åº¦ï¼š`batch_X` çš„å½¢çŠ¶ä¸º `(batch_size, 3)`ï¼ˆå› ä¸ºæœ‰3ä¸ªç‰¹å¾ï¼‰
- è¯¯å·®é¡¹ `error` å½¢çŠ¶ä¸º `(batch_size, 1)`

**è¿ç®—è¿‡ç¨‹åˆ†è§£ï¼š**

1. **è½¬ç½®æ“ä½œ**ï¼š

   python

   å¤åˆ¶

   ```
   batch_X.T  # å½¢çŠ¶ä» (40,3) å˜ä¸º (3,40)
   ```

2. **çŸ©é˜µä¹˜æ³•**ï¼š

   python

   å¤åˆ¶

   ```
   torch.matmul(batch_X.T, error)  # (3,40) Ã— (40,1) = (3,1)
   ```

3. **ç»“æœè§£é‡Š**ï¼š

   python

   å¤åˆ¶

   ```
   delta_w = ç»“æœçŸ©é˜µ / batch_size  # æœ€ç»ˆå½¢çŠ¶ä¿æŒ (3,1)
   ```

**å…·ä½“è®¡ç®—é€»è¾‘**ï¼š

- **æ¯ä¸ªç‰¹å¾å¯¹åº”ä¸€ä¸ªæ¢¯åº¦**ï¼šè¾“å‡ºçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªç‰¹å¾çš„æ¢¯åº¦æ›´æ–°é‡

- **è®¡ç®—æ–¹å¼**ï¼šå¯¹äºæ¯ä¸ªç‰¹å¾ï¼ˆå³`batch_X.T`çš„æ¯ä¸€è¡Œï¼‰ï¼š

  python

  å¤åˆ¶

  ```
  delta_w[i] = sum(ç‰¹å¾iåœ¨æ‰€æœ‰æ ·æœ¬ä¸­çš„å€¼ * å¯¹åº”æ ·æœ¬çš„è¯¯å·®) / batch_size
  ```

  è¿™ç›¸å½“äºå¯¹æ‰€æœ‰æ ·æœ¬åœ¨è¯¥ç‰¹å¾ä¸Šçš„è¯¯å·®è´¡çŒ®è¿›è¡ŒåŠ æƒå¹³å‡

**ç¤ºä¾‹è¯´æ˜**ï¼ˆå‡è®¾ batch_size=2ï¼‰ï¼š

python

å¤åˆ¶

```
# æ ·æœ¬ç‰¹å¾çŸ©é˜µï¼ˆ2ä¸ªæ ·æœ¬ï¼Œ3ä¸ªç‰¹å¾ï¼‰
batch_X = [[x11, x12, x13],  # æ ·æœ¬1
           [x21, x22, x23]]  # æ ·æœ¬2

# è¯¯å·®å‘é‡ï¼ˆ2ä¸ªæ ·æœ¬çš„è¯¯å·®ï¼‰
error = [e1, e2]

# è½¬ç½®åçš„ç‰¹å¾çŸ©é˜µ
batch_X.T = [[x11, x21],  # ç‰¹å¾1
             [x12, x22],  # ç‰¹å¾2
             [x13, x23]]  # ç‰¹å¾3

# çŸ©é˜µä¹˜æ³•ç»“æœï¼š
delta_w = [
    x11*e1 + x21*e2,  # ç‰¹å¾1çš„æ¢¯åº¦åˆ†é‡
    x12*e1 + x22*e2,  # ç‰¹å¾2çš„æ¢¯åº¦åˆ†é‡
    x13*e1 + x23*e2   # ç‰¹å¾3çš„æ¢¯åº¦åˆ†é‡
]
```

**å…³é”®ç†è§£ç‚¹**ï¼š

1. æ¯ä¸ªç‰¹å¾çš„æ¢¯åº¦æ˜¯è¯¥ç‰¹å¾åœ¨æ‰€æœ‰æ ·æœ¬ä¸­çš„å€¼ä¸å¯¹åº”è¯¯å·®çš„ç‚¹ç§¯
2. çŸ©é˜µä¹˜æ³•è‡ªåŠ¨å®Œæˆäº†å¯¹æ‰€æœ‰æ ·æœ¬çš„æ±‚å’Œæ“ä½œ
3. é™¤ä»¥ batch_size å®ç°äº†å¯¹mini-batchçš„å¹³å‡ï¼ˆå¯¹åº”SGDçš„éšæœºæ¢¯åº¦ä¼°è®¡ï¼‰

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼š

1. **å¹¶è¡Œè®¡ç®—**ï¼šåˆ©ç”¨çŸ©é˜µè¿ç®—çš„å¹¶è¡Œæ€§ï¼Œä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰ç‰¹å¾çš„æ¢¯åº¦
2. **æ•°å€¼ç¨³å®šæ€§**ï¼šæ‰¹é‡å¤„ç†æ¯”é€æ ·æœ¬æ›´æ–°æ›´ç¨³å®š
3. **æ•°å­¦ç­‰ä»·æ€§**ï¼šè¿™å®é™…ä¸Šæ˜¯å¯¹æŸå¤±å‡½æ•°æ±‚å¯¼åæ¢¯åº¦å…¬å¼çš„çŸ©é˜µè¡¨è¾¾å½¢å¼

**è¡¥å……è¯´æ˜**ï¼š

- å¯¹äºå½¢çŠ¶ä¸º `(3,40)` çš„ `batch_X.T` å’Œ `(40,1)` çš„ `error`ï¼ŒçŸ©é˜µä¹˜æ³•ç›¸å½“äºï¼š

  python

  å¤åˆ¶

  ```
  for i in 0..2:  # 3ä¸ªç‰¹å¾
      delta_w[i] = sum(batch_X[:,i] * error.flatten())
  ```

- æœ€ç»ˆå¾—åˆ°çš„ `delta_w` å½¢çŠ¶æ˜¯ `(3,1)`ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæ›´æ–° `w`ï¼ˆå½¢çŠ¶ `(3,)`ï¼‰

è¿™ç§è®¾è®¡ç¡®ä¿äº†ï¼š

1. æ¯ä¸ªç‰¹å¾ç‹¬ç«‹è®¡ç®—å…¶æ¢¯åº¦
2. å……åˆ†åˆ©ç”¨äº†çŸ©é˜µè¿ç®—çš„å¹¶è¡Œä¼˜åŠ¿
3. ä¸¥æ ¼å¯¹åº”é€»è¾‘å›å½’çš„æ¢¯åº¦å…¬å¼ï¼šâˆ‡w = X^T(Sigmoid(Xw + b) - y)/N



### 1.6item()æ–¹æ³•

åœ¨ PyTorch ä¸­ï¼Œ`loss.item()` çš„ä½œç”¨æ˜¯ä»åŒ…å«**å•ä¸ªæ ‡é‡å€¼**çš„å¼ é‡ï¼ˆTensorï¼‰ä¸­æå–å…¶æ•°å€¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Python çš„**åŸºæœ¬æ•°æ®ç±»å‹**ï¼ˆå¦‚ `float`ï¼‰ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šå’Œä½¿ç”¨åœºæ™¯ï¼š

------

#### **1. æ ¸å¿ƒä½œç”¨**

- **æå–æ ‡é‡å€¼**ï¼š
  å½“æŸå¤±å‡½æ•°ï¼ˆå¦‚ `nn.CrossEntropyLoss()`ï¼‰è¿”å›ä¸€ä¸ªå¼ é‡æ—¶ï¼Œè¯¥å¼ é‡å¯èƒ½åŒ…å«æ¢¯åº¦ä¿¡æ¯ï¼ˆ`requires_grad=True`ï¼‰ã€‚
  `loss.item()` ä¼šè¿”å›å¼ é‡ä¸­çš„**æ ‡é‡å€¼**ï¼Œå¹¶**ä¸¢å¼ƒæ¢¯åº¦ç­‰é¢å¤–ä¿¡æ¯**ã€‚
- **è½¬æ¢ä¸º Python ç±»å‹**ï¼š
  è¿”å›çš„æ˜¯ä¸€ä¸ª Python æ•°å€¼ï¼ˆå¦‚ `float`ï¼‰ï¼Œè€Œé PyTorch å¼ é‡ï¼Œæ–¹ä¾¿ç›´æ¥ä½¿ç”¨ï¼ˆä¾‹å¦‚æ‰“å°ã€è®°å½•æ—¥å¿—æˆ–å‚ä¸æ•°å€¼è®¡ç®—ï¼‰ã€‚













### 1.7ä¹‹å‰çš„æ–¹æ³•ï¼š

![image-20250121172613055](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250121172613055.png)

ç°åœ¨æ–¹æ³•ä¸€ï¼š

![image-20250121172827337](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250121172827337.png)

æ–¹æ³•äºŒï¼Œç”¨åˆ—è¡¨**ï¼ˆæ›´å¤šçµæ´»æ€§ï¼Œä½†æ˜¯æ›´éº»çƒ¦ï¼‰**ï¼š

![image-20250121173141823](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250121173141823.png)







### 1.8 LayerNormå‡½æ•°

![111045dd197522f5409e935ca842c652_720](C:\Users\hp\Documents\Tencent Files\1759751014\nt_qq\nt_data\Pic\2025-01\Thumb\111045dd197522f5409e935ca842c652_720.jpg)

### 1.9 Embeddingå‚æ•°

![1c48d54f13c3f1d54dbad08e6d882b6d_720](C:\Users\hp\Documents\Tencent Files\1759751014\nt_qq\nt_data\Pic\2025-01\Thumb\1c48d54f13c3f1d54dbad08e6d882b6d_720.jpg)

## 2. æ·±åº¦å­¦ä¹ çš„ç†è§£

### 2.1 æ·±åº¦å­¦ä¹ ä¸æœºå™¨å­¦ä¹ 

```
æœºå™¨å­¦ä¹ è¦è‡ªå·±æå–ç‰¹å¾ï¼Œæ·±åº¦å­¦ä¹ å®ƒè‡ªå·±ç”¨ç‰¹å¾æå–å™¨æå–
```



## 3. 























# **å¤§æ¨¡å‹**

## 1. åŸºç¡€

å¤§æ¨¡å‹æœ€æ“…é•¿çš„æ˜¯æ£€ç´¢ï¼Œå„ç§æ¡†æ¶å…¶å®æ˜¯æŠŠä»–çš„æ£€ç´¢å†…å®¹æ•´ç†ä¸€ä¸‹ã€‚å®ƒçš„æœ¬èº«èƒ½åŠ›ä¸å¤Ÿï¼Œåªæ˜¯çœ‹èµ·æ¥å¾ˆå…‰é²œã€‚

### å¤§æ¨¡å‹æµç¨‹

![image-20250131194035347](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131194035347.png)

transformeræ¶æ„è®©å¤§æ¨¡å‹æœ‰äº†è‡ªå·±çš„æ€æƒ³ï¼Œè®©å®ƒå¯ä»¥å›ç­”é—®é¢˜ã€‚

![image-20250131194512463](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131194512463.png)

![image-20250131194652620](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131194652620.png)

![image-20250131195807062](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131195807062.png)

### Agent

![image-20250131201748788](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131201748788.png)

![image-20250131202056421](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131202056421.png)

![image-20250131210809420](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131210809420.png)

![image-20250131211028307](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131211028307.png)

![image-20250131211619242](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131211619242.png)

![image-20250131213410331](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250131213410331.png)

### Agentç›¸å½“äºä»£ç†äººï¼Œå¤§è„‘è¿˜æ˜¯llm

![image-20250202150316304](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250202150316304.png)

![image-20250202152409381](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250202152409381.png)

### self ask ä¸æ˜¯é€šç”¨æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€äº›åŠ ä¸Šè‡ªé—®è‡ªç­”æ›´å¥½çš„æ¨¡å‹éœ€è¦

å¦‚ä¸‹æ˜¯self ask

![image-20250202153513963](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250202153513963.png)

![image-20250202154302706](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250202154302706.png)

æ¨¡å‹èƒ½åŠ›å®šä¸‹åï¼ŒAgenté€šè¿‡åŠ å…¥è‡ªæˆ‘è¯„ä¼°å’Œåæ€ç­‰ï¼Œè¿›ä¸€æ­¥æé«˜è§£å†³é—®é¢˜èƒ½åŠ›ï¼ˆç®€å•çš„é—®é¢˜ç”šè‡³å¯ä»¥ä¸ç”¨å·¥å…·ï¼‰ã€‚

ä¸Šè¿°reflectionè¿›è¡Œåæ€ï¼ˆå¦‚æœä¸åæ€ï¼Œä¼šå¯¼è‡´é€æ¸åç¦»åŸé—®é¢˜ï¼‰ã€‚





### æç¤ºçš„é‡è¦æ€§

![image-20250204225440045](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204225440045.png)

æç¤ºè¶Šå†—ä½™ï¼Œç»“æœè¶Šç¨³å®š



![image-20250204230855559](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204230855559.png)

### å°‘é‡æ ·æœ¬ä¸ä¼šæ”¹å˜æ¨¡å‹æœ¬èº«ï¼Œä½†æ˜¯fine-tuningä¼šæ”¹å˜æœ¬èº«

![image-20250204231302023](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204231302023.png)

### å„ç§å™¨

![image-20250204231629321](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204231629321.png)

![image-20250204231831687](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204231831687.png)

![image-20250205120837204](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205120837204.png)

![image-20250205135451677](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205135451677.png)

![image-20250205142500570](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205142500570.png)

![image-20250205143000994](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205143000994.png)

![image-20250205143222475](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205143222475.png)

![image-20250205143511524](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205143511524.png)



### æç¤ºè¯

æç¤ºè¯èµ·åˆ°å¯¹å¤§æ¨¡å‹è¿›è¡Œæ¸…æ´—å’Œç­›é€‰çš„ä½œç”¨ã€‚





![image-20250205155552098](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205155552098.png)

ç»™æ¨¡å‹æ€è€ƒæ—¶é—´ï¼š1.ç»™æ¨¡å‹è¶³å¤Ÿä¿¡æ¯

â€‹                               2.å¤æ‚çš„æ­¥éª¤ä¸­ï¼Œåˆ†æ­¥éª¤å¼•å¯¼æ¨¡å‹

![image-20250205160914917](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205160914917.png)

from langchain.prompts import FewShotPromptTemplate, PromptTemplate

### å®šä¹‰ç¤ºä¾‹é›†åˆ

examples = [
    {
        "input": "è‹¹æœ",
        "output": "æ°´æœï¼Œå¸¸è§é¢œè‰²æœ‰çº¢è‰²ã€ç»¿è‰²ã€‚"
    },
    {
        "input": "æ±½è½¦",
        "output": "äº¤é€šå·¥å…·ï¼Œé€šå¸¸æœ‰å››ä¸ªè½®å­ã€‚"
    }
]





å®šä¹‰å•ä¸ªç¤ºä¾‹çš„æ ¼å¼

example_template = """
è¾“å…¥ï¼š{input}
è¾“å‡ºï¼š{output}
"""
example_prompt = PromptTemplate.from_template(example_template)







ç»„åˆæˆ Few-Shot Prompt

few_shot_prompt = FewShotPromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
    prefix="æ ¹æ®ç¤ºä¾‹å›ç­”é—®é¢˜ï¼š",
    suffix="è¾“å…¥ï¼š{noun}\nè¾“å‡ºï¼š",
    input_variables=["noun"],
)





ä½¿ç”¨ Prompt

filled_prompt = few_shot_prompt.format(noun="å¤§è±¡")
print(filled_prompt)







### AIçŸ¥è¯†åº“ç±»åº”ç”¨æ‰€äº§ç”Ÿçš„å·¥ä½œæµ

![image-20250207145326563](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250207145326563.png)

![image-20250207150347171](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250207150347171.png)



## Langchain

### é“¾ç»“æ„

![image-20250205144509184](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250205144509184.png)

å¤šé“¾ç»“æ„ï¼Œä»£ç å†³å®šé€‰æ‹©å“ªæ¡é“¾å»è§£å†³é—®é¢˜æœ€å¥½ï¼Ÿ



### Langchainæç¤ºè¯æ¨¡æ¿



![image-20250204225702840](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204225702840.png)

![image-20250204230111157](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204230111157.png)

![image-20250204230630974](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20250204230630974.png)







### å†å²è®°å½•æ¨¡å—

![image-20250209191745071](../AppData/Roaming/Typora/typora-user-images/image-20250209191745071.png)

è¯´ç™½äº†ï¼šå°±æ˜¯æŠŠä¹‹å‰çš„èŠå¤©è®°å½•ä¸€å¹¶å‘ç»™å®ƒ





### Agentéå¸¸é‡è¦

![image-20250209192531641](../AppData/Roaming/Typora/typora-user-images/image-20250209192531641.png)

react:è¿™é‡Œæ˜¯reasoning and act

#### **1. åŸºæœ¬å®šä¹‰ä¸æ ¸å¿ƒç»„ä»¶**

RouterChainç”±ä¸¤éƒ¨åˆ†æ„æˆï¼š
- **è·¯ç”±é“¾ï¼ˆRouter Chainï¼‰**ï¼šè´Ÿè´£åˆ†æç”¨æˆ·è¾“å…¥å¹¶é€‰æ‹©ç›®æ ‡å­é“¾ï¼Œæ”¯æŒä¸¤ç§ä¸»è¦ç±»å‹ï¼š
  - **LLMRouterChain**ï¼šåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼Œé€šè¿‡æç¤ºæ¨¡æ¿ï¼ˆPrompt Templateï¼‰è®©LLMå†³å®šè·¯ç”±è·¯å¾„ã€‚
  - **EmbeddingRouterChain**ï¼šåˆ©ç”¨æ–‡æœ¬åµŒå…¥ï¼ˆEmbeddingï¼‰å’Œå‘é‡æ•°æ®åº“ï¼ˆå¦‚Chromaï¼‰ï¼Œé€šè¿‡ç›¸ä¼¼æ€§æœç´¢åŒ¹é…æœ€ç›¸å…³çš„å­é“¾ã€‚
- **ç›®æ ‡é“¾ï¼ˆDestination Chainsï¼‰**ï¼šå¤šä¸ªé¢„å…ˆå®šä¹‰çš„å­é“¾ï¼Œæ¯ä¸ªå­é“¾ä¸“ç²¾äºç‰¹å®šä»»åŠ¡ï¼ˆå¦‚ç‰©ç†é—®ç­”ã€è¯—æ­Œç”Ÿæˆç­‰ï¼‰ã€‚

æ­¤å¤–ï¼ŒRouterChainé€šå¸¸ä¸**MultiPromptChain**ç»“åˆä½¿ç”¨ï¼Œåè€…è´Ÿè´£æ•´åˆè·¯ç”±é“¾ã€å­é“¾å’Œé»˜è®¤é“¾ï¼ˆDefault Chainï¼‰ï¼Œå½“è¾“å…¥æ— æ³•åŒ¹é…ä»»ä½•å­é“¾æ—¶å¯ç”¨é»˜è®¤é“¾å…œåº•ã€‚

---

#### **2. å·¥ä½œåŸç†**

1. **è¾“å…¥è§£æ**ï¼šç”¨æˆ·è¾“å…¥è¢«ä¼ é€’ç»™RouterChainã€‚
2. **è·¯ç”±å†³ç­–**ï¼š
   - **LLMRouterChain**ï¼šLLMæ ¹æ®é¢„è®¾çš„æç¤ºæ¨¡æ¿ï¼ˆåŒ…å«å­é“¾æè¿°ï¼‰ç”ŸæˆJSONæ ¼å¼çš„è·¯ç”±æŒ‡ä»¤ï¼ŒåŒ…å«ç›®æ ‡é“¾åç§°åŠå¯èƒ½çš„è¾“å…¥è°ƒæ•´ã€‚
   - **EmbeddingRouterChain**ï¼šè®¡ç®—è¾“å…¥æ–‡æœ¬çš„å‘é‡è¡¨ç¤ºï¼Œä¸å„å­é“¾æè¿°å‘é‡è¿›è¡Œç›¸ä¼¼æ€§åŒ¹é…ï¼Œé€‰æ‹©æœ€æ¥è¿‘çš„å­é“¾ã€‚
3. **æ‰§è¡Œå­é“¾**ï¼šMultiPromptChainå°†è¾“å…¥ä¼ é€’ç»™é€‰ä¸­çš„å­é“¾ï¼Œç”Ÿæˆæœ€ç»ˆå“åº”ã€‚
4. **é»˜è®¤å¤„ç†**ï¼šè‹¥æ— åŒ¹é…å­é“¾ï¼Œåˆ™è°ƒç”¨é»˜è®¤é“¾ï¼ˆå¦‚é€šç”¨å¯¹è¯é“¾ï¼‰å¤„ç†ã€‚

### æ³¨æ„RAGæ£€ç´¢æ—¶å’Œæ–‡æœ¬åµŒå…¥å‘é‡æ—¶çš„åµŒå…¥æ¨¡å‹ä¸€å®šä¸€æ ·

ä¸ç„¶ä¼šå› ä¸ºä¸¤è€…ç»´åº¦ä¸åŒè€ŒçŠ¯é”™

### ç”¨Chromaåˆ›å»ºå‘é‡åº“å¦‚æœç”¨äº†client

é‚£ä¹ˆæ£€ç´¢çš„æ¨¡å‹ä¹Ÿè¦åŒ…å«client

![image-20250617151606284](../AppData/Roaming/Typora/typora-user-images/image-20250617151606284.png)







## langchainåŸºäºå‘é‡çš„æœç´¢ç´¢å¼•

### **ä»€ä¹ˆæ˜¯åŸºäºå‘é‡çš„æœç´¢ç´¢å¼•ï¼Ÿ**

åŸºäºå‘é‡çš„æœç´¢ç´¢å¼•ï¼ˆVector Search Indexï¼‰æ˜¯ä¸€ç§ **åˆ©ç”¨æœºå™¨å­¦ä¹ å’Œæ•°å­¦æ–¹æ³•**ï¼Œå°†æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ç­‰ **é«˜ç»´æ•°æ®** è½¬æ¢æˆ **å‘é‡**ï¼ˆVectorï¼‰ï¼Œå¹¶å­˜å‚¨åœ¨ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„ä¸­ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸ä¼¼æ€§æœç´¢ï¼ˆæ¯”å¦‚ä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§å‡ é‡Œå¾—è·ç¦»ï¼‰æ¥é«˜æ•ˆåœ°æŸ¥æ‰¾æœ€ç›¸å…³çš„å†…å®¹ã€‚

------

#### **ä¸ºä»€ä¹ˆéœ€è¦å‘é‡æœç´¢ï¼Ÿ**

ä¼ ç»Ÿçš„æ–‡æœ¬æœç´¢ï¼ˆæ¯”å¦‚æ•°æ®åº“çš„ SQL æŸ¥è¯¢ã€å…¨æ–‡æœç´¢ï¼‰é€šå¸¸æ˜¯ **åŸºäºå…³é”®å­—åŒ¹é…** çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š

- åªæœ‰å½“æŸ¥è¯¢çš„å…³é”®è¯**å®Œå…¨åŒ¹é…** æ–‡æœ¬ä¸­çš„æŸä¸ªå•è¯æ—¶ï¼Œæ‰èƒ½è¿”å›ç»“æœã€‚
- å¯¹äº**å«ä¹‰ç›¸ä¼¼ä½†è¡¨è¾¾ä¸åŒ**çš„æ–‡æœ¬ï¼Œä¼ ç»Ÿæ–¹æ³•æ— æ³•å¾ˆå¥½åœ°å¤„ç†ã€‚

æ¯”å¦‚ï¼Œå‡è®¾ä½ æœç´¢ï¼š

> **"å¦‚ä½•è§£å†³æ•°ç»„æ’åºé—®é¢˜ï¼Ÿ"**

ä¼ ç»Ÿçš„å…³é”®è¯åŒ¹é…å¯èƒ½åªä¼šæ‰¾åˆ°åŒ…å« "**æ•°ç»„æ’åº**" è¿™ä¸ªè¯çš„æ–‡ç« ï¼Œè€Œä¸ä¼šæ‰¾åˆ° "**å¦‚ä½•å¯¹åˆ—è¡¨è¿›è¡Œæ’åº**" çš„å†…å®¹ï¼Œå› ä¸º "æ•°ç»„" å’Œ "åˆ—è¡¨" è™½ç„¶æ„æ€ç›¸è¿‘ï¼Œä½†å®ƒä»¬çš„å…³é”®è¯ä¸åŒã€‚

**åŸºäºå‘é‡çš„æœç´¢** åˆ™ä¼šåˆ©ç”¨ **æ·±åº¦å­¦ä¹ çš„è¯åµŒå…¥æŠ€æœ¯ï¼ˆword embeddingï¼‰**ï¼ŒæŠŠå¥å­çš„å«ä¹‰è½¬æ¢æˆä¸€ä¸ªå‘é‡ï¼Œå³ä½¿æŸ¥è¯¢è¯­å¥çš„è¡¨è¿°ä¸åŒï¼Œä»ç„¶èƒ½æ‰¾åˆ°æ„æ€ç›¸è¿‘çš„å†…å®¹ã€‚

------

#### **å‘é‡æœç´¢çš„æ ¸å¿ƒæ¦‚å¿µ**

1. **å‘é‡ï¼ˆVectorï¼‰**
   - è®¡ç®—æœºä¸èƒ½ç›´æ¥ç†è§£æ–‡æœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨**æ•°å€¼**è¡¨ç¤ºæ–‡æœ¬ã€‚
   - ç°ä»£ NLPï¼ˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼‰æ–¹æ³•ä¼šæŠŠæ–‡æœ¬è½¬æ¢æˆä¸€ä¸ªé«˜ç»´å‘é‡ã€‚ä¾‹å¦‚ï¼š
     - "è‹¹æœ" å¯èƒ½è¢«è¡¨ç¤ºä¸º `[0.12, 0.98, -0.33, ...]`
     - "æ©˜å­" å¯èƒ½è¢«è¡¨ç¤ºä¸º `[0.13, 0.95, -0.30, ...]`
     - ç”±äºè¿™ä¸¤ä¸ªå‘é‡å¾ˆç›¸ä¼¼ï¼Œè¯´æ˜å®ƒä»¬çš„æ„æ€ä¹Ÿå¾ˆæ¥è¿‘ã€‚
2. **åµŒå…¥æ¨¡å‹ï¼ˆEmbedding Modelï¼‰**
   - è´Ÿè´£æŠŠæ–‡æœ¬è½¬æ¢æˆå‘é‡ï¼Œæ¯”å¦‚ï¼š
     - `OpenAIEmbeddings()`ï¼ˆOpenAI æä¾›çš„åµŒå…¥æ¨¡å‹ï¼‰
     - `Sentence-BERT`ï¼ˆåŸºäº BERT çš„å¥å­å‘é‡æ¨¡å‹ï¼‰
     - `word2vec`ï¼ˆæ—©æœŸçš„è¯å‘é‡æ¨¡å‹ï¼‰
3. **ç›¸ä¼¼æ€§è®¡ç®—**
   - è®¡ç®—æŸ¥è¯¢æ–‡æœ¬ä¸ç´¢å¼•ä¸­çš„æ–‡æœ¬ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå¸¸ç”¨æ–¹æ³•ï¼š
     - **ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰**ï¼šè¡¡é‡ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ï¼Œè¶Šæ¥è¿‘ 1 ä»£è¡¨è¶Šç›¸ä¼¼ã€‚
     - **æ¬§å‡ é‡Œå¾—è·ç¦»ï¼ˆEuclidean Distanceï¼‰**ï¼šè¡¡é‡ä¸¤ä¸ªå‘é‡åœ¨ç©ºé—´ä¸­çš„ç›´çº¿è·ç¦»ï¼Œè¶Šå°ä»£è¡¨è¶Šç›¸ä¼¼ã€‚
4. **å‘é‡å­˜å‚¨ï¼ˆVector Storeï¼‰**
   - å­˜å‚¨å¤§é‡çš„æ–‡æœ¬å‘é‡ï¼Œå¹¶æ”¯æŒé«˜æ•ˆæ£€ç´¢ï¼Œå¸¸è§çš„å‘é‡æ•°æ®åº“ï¼š
     - **FAISS**ï¼ˆFacebook AI å¼€æºçš„å‘é‡æœç´¢åº“ï¼Œæ”¯æŒé«˜æ•ˆæœ€è¿‘é‚»æœç´¢ï¼‰
     - **Chroma**ï¼ˆä¸€ä¸ªç®€å•æ˜“ç”¨çš„å‘é‡æ•°æ®åº“ï¼‰
     - **Pinecone**ï¼ˆäº‘ç«¯å‘é‡æ•°æ®åº“ï¼‰

------

#### **å‘é‡æœç´¢çš„å·¥ä½œæµç¨‹**

ä»¥ä½ çš„ä»£ç ä¸ºä¾‹ï¼Œå‘é‡æœç´¢çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1. **åŠ è½½ PDF æ–‡æ¡£**

   - `PyPDFLoader()` è§£æ PDF å¹¶æå–æ–‡æœ¬ã€‚

2. **æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡**

   - ```
     OpenAIEmbeddings()
     ```

      å¤„ç†æ–‡æœ¬ï¼Œå°†å…¶è½¬æ¢ä¸ºå‘é‡ã€‚ä¾‹å¦‚ï¼š

     - `"å¦‚ä½•æ’åºæ•°ç»„"` â†’ `[0.12, 0.98, -0.33, ...]`
     - `"å¯¹åˆ—è¡¨è¿›è¡Œæ’åºçš„æ–¹æ³•"` â†’ `[0.13, 0.95, -0.30, ...]`
     - ç”±äºå®ƒä»¬çš„å‘é‡æ¥è¿‘ï¼Œå³ä½¿å…³é”®è¯ä¸åŒï¼Œæœç´¢ä»ç„¶å¯ä»¥åŒ¹é…åˆ°æ­£ç¡®çš„å†…å®¹ã€‚

3. **å­˜å‚¨å‘é‡ç´¢å¼•**

   - `FAISS` è´Ÿè´£å­˜å‚¨è¿™äº›å‘é‡ï¼Œå¹¶å»ºç«‹ç´¢å¼•ã€‚

4. **æŸ¥è¯¢**

   - ä½ è¾“å…¥ä¸€ä¸ªæŸ¥è¯¢ï¼ˆæ¯”å¦‚ `"å¦‚ä½•é«˜æ•ˆæ’åºæ•°æ®"`ï¼‰ã€‚
   - è¿™ä¸ªæŸ¥è¯¢ä¼šè¢« **è½¬æ¢æˆå‘é‡** å¹¶ä¸ç´¢å¼•ä¸­çš„å‘é‡è¿›è¡Œç›¸ä¼¼æ€§æ¯”è¾ƒã€‚
   - è¿”å›æœ€ç›¸ä¼¼çš„æ–‡æœ¬ç‰‡æ®µã€‚



### æ¯ä¸ªæ–‡æœ¬åµŒå…¥å‘é‡ç»´åº¦è§£é‡Š

æ¯ä¸ªæ–‡æœ¬çš„åµŒå…¥å‘é‡ç»´åº¦è¡¨ç¤ºè¯¥æ–‡æœ¬åœ¨ **å‘é‡ç©ºé—´** ä¸­çš„ **è¡¨ç¤º**ã€‚æ¯ä¸ªå‘é‡çš„ç»´åº¦æ˜¯ç”±åµŒå…¥æ¨¡å‹å†³å®šçš„ï¼Œé€šå¸¸è¶Šé«˜ç»´åº¦çš„å‘é‡èƒ½è¡¨è¾¾è¶Šä¸°å¯Œçš„è¯­ä¹‰ä¿¡æ¯ã€‚åœ¨ OpenAI çš„åµŒå…¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªæ–‡æœ¬çš„åµŒå…¥é€šå¸¸æ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ï¼Œå…·ä½“ç»´åº¦å–å†³äºæ¨¡å‹ã€‚

#### ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡æœ¬ï¼š

1. **æ–‡æœ¬ 1**ï¼š"ä»Šå¤©çš„å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå¤–å‡ºæ¸¸ç©ã€‚"
2. **æ–‡æœ¬ 2**ï¼š"å¤–é¢çš„é˜³å…‰æ˜åªšï¼Œæ¸©åº¦é€‚å®œï¼Œéå¸¸é€‚åˆè¿åŠ¨ã€‚"

æˆ‘ä»¬é€šè¿‡ OpenAI çš„åµŒå…¥æ¨¡å‹å°†è¿™ä¸¤ä¸ªæ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡ã€‚å‡è®¾æ¯ä¸ªæ–‡æœ¬è¢«åµŒå…¥ä¸ºä¸€ä¸ª 512 ç»´çš„å‘é‡ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼ŒOpenAI æä¾›çš„åµŒå…¥æ¨¡å‹ä¼šè¾“å‡ºä¸€ä¸ª 512 ç»´çš„å‘é‡ï¼Œå…·ä½“ç»´åº¦ä¼šæ ¹æ®æ¨¡å‹è€Œæœ‰æ‰€ä¸åŒï¼‰ã€‚

- **æ–‡æœ¬ 1 çš„åµŒå…¥å‘é‡**ï¼š`[0.123, -0.345, 0.567, ..., 0.987]`ï¼ˆå…± 512 ä¸ªæ•°å€¼ï¼‰
- **æ–‡æœ¬ 2 çš„åµŒå…¥å‘é‡**ï¼š`[0.321, -0.432, 0.654, ..., -0.123]`ï¼ˆå…± 512 ä¸ªæ•°å€¼ï¼‰

#### å‘é‡ç»´åº¦çš„ä½œç”¨ï¼š

- è¿™äº›åµŒå…¥å‘é‡çš„æ¯ä¸ªæ•°å­—ä»£è¡¨äº†æ–‡æœ¬åœ¨æŸä¸€ç»´åº¦ä¸Šçš„è¯­ä¹‰ç‰¹å¾ã€‚ä¾‹å¦‚ï¼ŒæŸäº›ç»´åº¦å¯èƒ½ä¼šæ•æ‰åˆ° **å¤©æ°”** ç›¸å…³çš„è¯æ±‡ï¼Œè€Œå…¶ä»–ç»´åº¦å¯èƒ½ä¼šå…³æ³¨ **æ´»åŠ¨** æˆ– **è¿åŠ¨** ç›¸å…³çš„è¯­ä¹‰ã€‚
- åµŒå…¥å‘é‡çš„æ¯ä¸ªæ–‡æœ¬éƒ½è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ 512 ç»´ï¼‰ï¼Œè¯¥å‘é‡çš„ä¸åŒç»´åº¦ä¼šæ ¹æ®æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­æ‰€å­¦åˆ°çš„è¯­è¨€è§„å¾‹æ¥åˆ†é…ç›¸åº”çš„è¯­ä¹‰ä¿¡æ¯ã€‚

#### ç»´åº¦çš„ä½œç”¨ï¼š

- **æ–‡æœ¬ç›¸ä¼¼åº¦**ï¼šé€šè¿‡æ¯”è¾ƒä¸¤ä¸ªæ–‡æœ¬çš„åµŒå…¥å‘é‡ï¼Œå¯ä»¥è®¡ç®—å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚å¦‚æœä¸¤ä¸ªæ–‡æœ¬çš„åµŒå…¥å‘é‡åœ¨å‘é‡ç©ºé—´ä¸­è¾ƒä¸ºæ¥è¿‘ï¼Œåˆ™è¯´æ˜è¿™ä¸¤ä¸ªæ–‡æœ¬çš„è¯­ä¹‰ä¸Šè¾ƒä¸ºç›¸ä¼¼ã€‚ä¾‹å¦‚ï¼Œ`æ–‡æœ¬ 1` å’Œ `æ–‡æœ¬ 2` çš„åµŒå…¥å‘é‡å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„ç›¸ä¼¼åº¦ï¼Œå› ä¸ºå®ƒä»¬è®¨è®ºçš„æ˜¯ç›¸ä¼¼çš„ä¸»é¢˜ï¼šå¤©æ°”å’Œé€‚åˆå¤–å‡ºæ´»åŠ¨ã€‚
- **æ–‡æœ¬èšç±»**ï¼šé€šè¿‡å°†å¤šä¸ªæ–‡æœ¬åµŒå…¥ä¸ºå‘é‡å¹¶è¿›è¡Œèšç±»ï¼Œå¯ä»¥å°†ç›¸ä¼¼ä¸»é¢˜çš„æ–‡æœ¬åˆ†ä¸ºä¸€ç±»ï¼Œä»è€Œå®ç°æ›´é«˜æ•ˆçš„æ–‡æœ¬åˆ†ç±»æˆ–ä¿¡æ¯æ£€ç´¢ã€‚



### searchæœç´¢åŒ¹é…å‘é‡

å› ä¸º Faiss è¦æ±‚æŸ¥è¯¢è¾“å…¥æ˜¯ `(num_queries, dimension)` å½¢çŠ¶çš„æ•°ç»„ï¼Œæ‰€ä»¥`.reshape((1, embed_dim))` æŠŠå‘é‡è½¬æ¢ä¸º **äºŒç»´æ ¼å¼**ï¼Œ

æ˜¯çš„ï¼Œ`idx` é‡Œå­˜å‚¨çš„æ˜¯ **æœ€ç›¸ä¼¼æ–‡æœ¬çš„ç´¢å¼•ï¼ˆæ•´æ•°ï¼‰**ï¼Œä¹Ÿå°±æ˜¯å®ƒä»¬åœ¨ `texts` åˆ—è¡¨ä¸­çš„ä½ç½®ç¼–å·ï¼ˆç´¢å¼•å€¼ï¼‰ã€‚

åœ¨ Faiss ä¸­ï¼Œ`index_innerproduct.search(...)` è¿”å›ä¸¤ä¸ªæ•°ç»„ï¼š

```
python


å¤åˆ¶ç¼–è¾‘
data, idx = index_innerproduct.search(query_embed[0].reshape((1, embed_dim)), topk)
```

- `data`ï¼šå½¢çŠ¶æ˜¯ `(1, topk)`ï¼ŒåŒ…å« **åŒ¹é…åº¦åˆ†æ•°**ï¼ˆé€šå¸¸æ˜¯å†…ç§¯æˆ– L2 è·ç¦»ï¼‰ã€‚
- `idx`ï¼šå½¢çŠ¶æ˜¯ `(1, topk)`ï¼ŒåŒ…å« **æœ€ç›¸ä¼¼æ–‡æœ¬çš„ç´¢å¼•ï¼ˆæ•´æ•°ï¼‰**ï¼Œè¿™äº›ç´¢å¼•å¯ä»¥ç”¨æ¥è®¿é—® `texts` ä¸­çš„åŸå§‹æ–‡æœ¬



### ç´¢å¼•çš„ä¸åŒ

### **1. Faiss ç´¢å¼•ï¼ˆIndexFlatL2 / IndexFlatIPï¼‰**

**åœ¨ Faiss ä¸­ï¼Œ"ç´¢å¼•"ï¼ˆIndexï¼‰æŒ‡çš„æ˜¯æ•´ä¸ªå‘é‡æ•°æ®åº“**ï¼Œå®ƒçš„ä½œç”¨æ˜¯å­˜å‚¨å’ŒæŸ¥è¯¢å‘é‡ã€‚

- `index_L2 = faiss.IndexFlatL2(embed_dim)`
- `index_innerproduct = faiss.IndexFlatIP(embed_dim)`

è¿™äº›æ˜¯ **Faiss ç´¢å¼•å¯¹è±¡**ï¼Œç”¨äºå­˜å‚¨å‘é‡æ•°æ®ï¼Œå¹¶æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚
ğŸ‘‰ **å®ƒä»¬æ˜¯â€œæ•°æ®åº“â€æœ¬èº«ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ•°æ®ç´¢å¼•å·ã€‚**

**æ·»åŠ æ•°æ®åˆ°ç´¢å¼•ï¼š**

```
python


å¤åˆ¶ç¼–è¾‘
index_innerproduct.add(np_embeddings)  
```

è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯ **æŠŠ `np_embeddings`ï¼ˆæ‰€æœ‰æ–‡æœ¬çš„å‘é‡ï¼‰æ·»åŠ åˆ° Faiss ç´¢å¼•ä¸­**ã€‚
åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒFaiss **è‡ªåŠ¨ä¸ºæ¯ä¸ªå‘é‡åˆ†é…ä¸€ä¸ªæ•´æ•°ç´¢å¼•ç¼–å·**ï¼ˆä» `0` å¼€å§‹ï¼‰ã€‚

------

### **2. `idx` é‡Œçš„ç´¢å¼•ï¼ˆæœ€ç›¸ä¼¼æ–‡æœ¬çš„ç´¢å¼•ï¼‰**

```
python


å¤åˆ¶ç¼–è¾‘
data, idx = index_innerproduct.search(query_embed[0].reshape((1, embed_dim)), topk)
```

- `idx` æ˜¯ Faiss è¿›è¡Œç›¸ä¼¼æ€§æœç´¢åè¿”å›çš„ç»“æœã€‚
- `idx` é‡Œå­˜å‚¨çš„æ˜¯ **Faiss ç´¢å¼•ä¸­çš„å‘é‡ç¼–å·ï¼ˆæ•´æ•°ï¼‰**ã€‚
- è¿™äº›ç¼–å· **å¯¹åº” `texts` åˆ—è¡¨ä¸­çš„æ–‡æœ¬ç´¢å¼•**







## RAG

### è¿‡ç¨‹

RAGè¿‡ç¨‹å±•å¼€å¦‚ ä¸‹ï¼šï¼ˆiï¼‰æ£€ç´¢å™¨æœ€åˆæ¥æ”¶è¾“å…¥æŸ¥è¯¢å¹¶æœç´¢ç›¸å…³ä¿¡ æ¯ï¼› (ii) ç„¶åï¼Œé€šè¿‡ç‰¹å®šçš„å¢å¼ºæ–¹æ³•å°†åŸå§‹æŸ¥è¯¢å’Œæ£€ ç´¢ç»“æœè¾“å…¥ç”Ÿæˆå™¨ï¼› (iii)æœ€åï¼Œç”Ÿæˆå™¨äº§ç”ŸæœŸæœ›çš„ç»“ æœã€‚

#### æ£€ç´¢å™¨

å¯†é›†æ£€ç´¢å™¨å’Œç¨€ç–æ£€ç´¢å™¨æ˜¯ä¿¡æ¯æ£€ç´¢é¢†åŸŸä¸­ä¸¤ç§å¸¸è§çš„æŠ€æœ¯ï¼Œå®ƒä»¬åœ¨åŸç†ã€ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼š


å¯†é›†æ£€ç´¢å™¨ï¼ˆDense Retrievalï¼‰

1. å®šä¹‰

å¯†é›†æ£€ç´¢å™¨é€šè¿‡å°†æ–‡æœ¬ï¼ˆå¦‚æ–‡æ¡£å’ŒæŸ¥è¯¢ï¼‰æ˜ å°„åˆ°é«˜ç»´è¿ç»­å‘é‡ç©ºé—´ä¸­ï¼Œåˆ©ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰æ¥æ£€ç´¢ç›¸å…³æ–‡æ¡£ã€‚


2. æŠ€æœ¯å®ç°

å¯†é›†æ£€ç´¢é€šå¸¸ä¾èµ–äºæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¦‚BERTã€GPTæˆ–å…¶ä»–é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œå°†æ–‡æœ¬è½¬æ¢ä¸ºå¯†é›†çš„å‘é‡è¡¨ç¤ºã€‚è¿™äº›å‘é‡èƒ½å¤Ÿæ•æ‰æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå³ä½¿æŸ¥è¯¢å’Œæ–‡æ¡£ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„è¯æ±‡é‡å ï¼Œä¹Ÿèƒ½æ‰¾åˆ°è¯­ä¹‰ç›¸å…³çš„æ–‡æ¡£ã€‚


3. ç‰¹ç‚¹

â€¢ è¯­ä¹‰åŒ¹é…èƒ½åŠ›å¼ºï¼šèƒ½å¤Ÿç†è§£æ–‡æœ¬çš„æ·±å±‚è¯­ä¹‰ï¼Œé€‚åˆå¤æ‚è¯­ä¹‰æ£€ç´¢åœºæ™¯ã€‚

â€¢ è®¡ç®—éœ€æ±‚é«˜ï¼šéœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºæ¥è®­ç»ƒå’Œè¿è¡Œæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚

â€¢ ç»“æœè§£é‡Šæ€§ä½ï¼šå‘é‡çš„ç»´åº¦ä¸ç›´è§‚ï¼Œéš¾ä»¥ç›´æ¥è§£é‡Šæ£€ç´¢ç»“æœã€‚


4. åº”ç”¨åœºæ™¯

å¯†é›†æ£€ç´¢å¹¿æ³›åº”ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ï¼Œå¦‚æ™ºèƒ½é—®ç­”ç³»ç»Ÿã€å†…å®¹æ¨èç³»ç»Ÿå’Œè¯­ä¹‰æœç´¢ã€‚


ç¨€ç–æ£€ç´¢å™¨ï¼ˆSparse Retrievalï¼‰

1. å®šä¹‰

ç¨€ç–æ£€ç´¢å™¨åŸºäºç¦»æ•£çš„å…³é”®è¯æˆ–çŸ­è¯­æ¥ç´¢å¼•å’Œæ£€ç´¢æ•°æ®ã€‚å®ƒå°†æ–‡æœ¬è¡¨ç¤ºä¸ºç¨€ç–å‘é‡ï¼Œé€šå¸¸ä½¿ç”¨è¯è¢‹æ¨¡å‹ï¼ˆBag of Wordsï¼‰æˆ–TF-IDFï¼ˆè¯é¢‘-é€†æ–‡æ¡£é¢‘ç‡ï¼‰æ¥è®¡ç®—æ–‡æ¡£ä¸æŸ¥è¯¢çš„ç›¸å…³æ€§ã€‚


2. æŠ€æœ¯å®ç°

ç¨€ç–æ£€ç´¢é€šè¿‡ç»Ÿè®¡æ–‡æ¡£ä¸­è¯çš„å‡ºç°æ¬¡æ•°å’Œé€†æ–‡æ¡£é¢‘ç‡æ¥æ„å»ºç¨€ç–å‘é‡ã€‚ä¾‹å¦‚ï¼ŒTF-IDFç®—æ³•ä¼šä¸ºæ¯ä¸ªè¯åˆ†é…æƒé‡ï¼Œè¡¨ç¤ºå…¶åœ¨æ–‡æ¡£ä¸­çš„é‡è¦æ€§ã€‚


3. ç‰¹ç‚¹

â€¢ é«˜æ•ˆç‡å’Œå¯æ‰©å±•æ€§ï¼šé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ï¼Œå› ä¸ºè®¡ç®—å’Œå­˜å‚¨æˆæœ¬è¾ƒä½ã€‚

â€¢ å¼ºè§£é‡Šæ€§ï¼šæ£€ç´¢ç»“æœåŸºäºæ˜ç¡®çš„è¯æ±‡åŒ¹é…ï¼Œå®¹æ˜“ç†è§£ã€‚

â€¢ ä¾èµ–å…³é”®è¯ï¼šæ•ˆæœé«˜åº¦ä¾èµ–äºæŸ¥è¯¢è¯ä¸æ–‡æ¡£ä¸­è¯çš„åŒ¹é…åº¦ï¼Œæ— æ³•è§£å†³æœ¯è¯­ä¸åŒ¹é…é—®é¢˜ã€‚


4. åº”ç”¨åœºæ™¯

ç¨€ç–æ£€ç´¢å¸¸ç”¨äºä¼ ç»Ÿçš„æœç´¢å¼•æ“ã€ç½‘é¡µæœç´¢å’Œæ–‡æ¡£åº“æ£€ç´¢ç­‰åœºæ™¯ã€‚


æ€»ç»“

â€¢ å¯†é›†æ£€ç´¢å™¨æ›´é€‚åˆéœ€è¦ç†è§£å¤æ‚è¯­ä¹‰çš„åœºæ™¯ï¼Œä½†è®¡ç®—æˆæœ¬è¾ƒé«˜ã€‚

â€¢ ç¨€ç–æ£€ç´¢å™¨æ›´é€‚åˆå¤§è§„æ¨¡æ•°æ®æ£€ç´¢å’Œå¯¹è®¡ç®—èµ„æºè¦æ±‚è¾ƒä½çš„åœºæ™¯ï¼Œä½†è¯­ä¹‰ç†è§£èƒ½åŠ›è¾ƒå¼±ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸¤è€…ä¹Ÿå¯ä»¥ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚å…ˆç”¨å¯†é›†æ£€ç´¢å¿«é€Ÿç¼©å°æœç´¢èŒƒå›´ï¼Œå†ç”¨ç¨€ç–æ£€ç´¢ç»†åŒ–ç»“æœã€‚

#### å¯ä»¥åšæ–‡ç« çš„åœ°æ–¹

æœç´¢æ–¹å¼

RAGçš„ç»“æ„æœ‰å¾ˆå¤šç§

æˆ‘ä»¬å°†ä»‹ç»å¢å¼ºæ‰€æ„å»ºçš„ RAG ç³»ç»Ÿæ€§èƒ½ çš„æ–¹æ³•ã€‚æˆ‘ä»¬æ ¹æ®ç°æœ‰æ–¹æ³•çš„å¢å¼ºç›®æ ‡å°†å…¶åˆ†ä¸º 5 ç»„ï¼šè¾“å…¥ã€æ£€ç´¢å™¨ã€ç”Ÿæˆå™¨ã€ç»“æœå’Œæ•´ä¸ªç®¡é“ã€‚

ä¸¤ç§ç¡®å®šæ£€ç´¢å¿…è¦æ€§çš„æ–¹æ³•ï¼šåŸºäºè§„åˆ™çš„æ–¹æ³•å’ŒåŸºäºæ¨¡ å‹çš„æ–¹æ³•ã€‚

ragå¤„ç†ä»£ç 

æ£€ç´¢åˆ°çš„è¡¨ä¸æŸ¥è¯¢è¿æ¥èµ· æ¥ä»¥ç”Ÿæˆç­”æ¡ˆ

ä»å¤šä¸ªæºæ£€ç´¢ï¼ŒåŒ…æ‹¬çŸ¥ è¯†å›¾è°±ã€è¡¨æ ¼å’Œæ•°æ®åº“

åœ¨ NLP é¢†åŸŸï¼Œ**å®ä½“**é€šå¸¸æŒ‡çš„æ˜¯æ–‡æœ¬ä¸­å…·æœ‰ç‰¹å®šæ„ä¹‰çš„åç§°æˆ–æœ¯è¯­

å‡ ä¸ªä»æŸäº›æ–¹é¢è¯„ä¼°RAGçš„åŸºå‡†ã€‚ [318]æ å‡ºäº†ä¸€ä¸ªRAGåŸºå‡†ï¼Œä»å››ä¸ªç»´åº¦è¿›è¡Œè¯„ä¼°ï¼šï¼ˆ1ï¼‰ å™ªå£°é²æ£’æ€§ï¼Œæµ‹è¯•LLMæ˜¯å¦å¯ä»¥ä»å™ªå£°æ–‡æ¡£ä¸­æå– å¿…è¦çš„ä¿¡æ¯ï¼› ï¼ˆ2ï¼‰æ¶ˆææ‹’ç»ï¼Œè¯„ä¼°LLMåœ¨æ£€ç´¢åˆ° çš„å†…å®¹ä¸å……åˆ†æ—¶æ˜¯å¦å¯ä»¥æ‹’ç»å›å¤ï¼› (3)ä¿¡æ¯æ•´ åˆï¼Œæ£€æŸ¥LLMæ˜¯å¦èƒ½å¤Ÿé€šè¿‡æ•´åˆå¤šä¸ªæ£€ç´¢å†…å®¹æ¥è· å–çŸ¥è¯†å¹¶åšå‡ºååº”ï¼› (4)åäº‹å®é²æ£’æ€§ï¼Œç¡®å®šLLM æ˜¯å¦å¯ä»¥è¯†åˆ«æ£€ç´¢åˆ°çš„å†…å®¹ä¸­çš„åäº‹å®é”™è¯¯ã€‚

æ£€ç´¢å™¨å’Œç”Ÿæˆå™¨ä¹‹é—´çš„å·®è·ï¼šç”±äºæ£€ç´¢å™¨ å’Œç”Ÿæˆå™¨çš„ç›®æ ‡å¯èƒ½ä¸ä¸€è‡´ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ½œåœ¨ç©ºé—´ å¯èƒ½ä¸åŒï¼Œå› æ­¤è®¾è®¡å®ƒä»¬çš„äº¤äº’éœ€è¦ç²¾å¿ƒè®¾è®¡å’Œä¼˜ åŒ–ã€‚å½“å‰çš„æ–¹æ³•è¦ä¹ˆè§£å¼€æ£€ç´¢å’Œç”Ÿæˆï¼Œè¦ä¹ˆåœ¨ä¸­é—´ é˜¶æ®µå°†å®ƒä»¬é›†æˆã€‚è™½ç„¶å‰è€…æ›´åŠ æ¨¡å—åŒ–ï¼Œä½†åè€…å¯ ä»¥ä»è”åˆè®­ç»ƒä¸­å—ç›Šï¼Œä½†ä¼šå¦¨ç¢é€šç”¨æ€§ã€‚

å†—é•¿çš„ä¸Šä¸‹ æ–‡ï¼šRAGï¼ˆå°¤å…¶æ˜¯åŸºäºæŸ¥è¯¢çš„ RAGï¼‰çš„ä¸»è¦ç¼ºç‚¹ ä¹‹ä¸€æ˜¯å®ƒæå¤§åœ°å»¶é•¿äº†ä¸Šä¸‹æ–‡ï¼Œä½¿å¾—ä¸Šä¸‹æ–‡é•¿åº¦æœ‰ é™çš„ç”Ÿæˆå™¨ä¸å¯è¡Œã€‚æ­¤å¤–ï¼ŒåŠ é•¿çš„ä¸Šä¸‹æ–‡é€šå¸¸ä¹Ÿä¼š å‡æ…¢ç”Ÿæˆè¿‡ç¨‹ã€‚

æ¥ RAG ç ”ç©¶å’Œåº”ç”¨çš„å‡ ä¸ª æ½œåœ¨æ–¹å‘ã€‚1ï¼‰å¢å¼ºæ–¹æ³•çš„æ–°é¢–è®¾è®¡ï¼šç°æœ‰ç ”ç©¶å·² ç»æ¢ç´¢äº†æ£€ç´¢å™¨å’Œç”Ÿæˆå™¨ä¹‹é—´çš„å„ç§äº¤äº’æ¨¡å¼ã€‚ç„¶ è€Œï¼Œç”±äºè¿™ä¸¤ä¸ªç»„ä»¶çš„ç›®æ ‡ä¸åŒï¼Œå®é™…çš„å¢å¼ºè¿‡ç¨‹ å¯¹æœ€ç»ˆçš„ç”Ÿæˆç»“æœæœ‰é‡å¤§å½±å“ã€‚å¯¹æ›´å…ˆè¿›çš„å¢å¼ºåŸº ç¡€çš„ç ”ç©¶æœ‰æœ›å……åˆ†é‡Šæ”¾ RAG çš„æ½œåŠ›ã€‚2ï¼‰çµæ´»çš„ RAG ç®¡é“ï¼šRAG ç³»ç»Ÿæ­£åœ¨é€æ­¥é‡‡ç”¨çµæ´»çš„ç®¡é“ï¼Œ ä¾‹å¦‚é€’å½’ã€è‡ªé€‚åº”å’Œè¿­ä»£ RAGã€‚é™¤äº†å¯¹æ¯ä¸ªç»„ä»¶è¿› è¡Œé€‚å½“çš„è°ƒæ•´å’Œç²¾å¿ƒè®¾è®¡ä¹‹å¤–ï¼Œæ£€ç´¢æºã€æ£€ç´¢å™¨ã€ ç”Ÿæˆå™¨å’Œ RAG å­ç³»ç»Ÿçš„ç‹¬ç‰¹ç»„åˆæœ‰æœ›å¤„ç†å¤æ‚çš„ ä»»åŠ¡å¹¶æé«˜æ•´ä½“æ€§èƒ½ã€‚



### æ“ä½œç»†èŠ‚



#### é—®é¢˜ç±»å‹

![image-20250219170647636](../AppData/Roaming/Typora/typora-user-images/image-20250219170647636.png)



#### è„šæœ¬æ‰§è¡Œ



è¿™æ˜¯è„šæœ¬

![image-20250310145958384](../AppData/Roaming/Typora/typora-user-images/image-20250310145958384.png)

5. è„šæœ¬çš„ä½œç”¨å’Œè¿è¡Œæ–¹å¼

- **ä½œç”¨**ï¼š

  1. **ä¸€é”®è¿è¡Œæ¨ç†æµç¨‹**ï¼šæ¯æ¬¡éƒ½æ‰‹åŠ¨è¾“å…¥é•¿ä¸²å‘½ä»¤ã€‚
  2. **å›ºå®šè·¯å¾„å’Œå‚æ•°**ï¼šæŠŠæ‰€æœ‰éœ€è¦çš„æ–‡ä»¶è·¯å¾„ã€æ¨¡å‹è·¯å¾„ã€é˜ˆå€¼ã€æ–¹æ³•ç­‰éƒ½å†™æ­»åœ¨è„šæœ¬é‡Œï¼Œæ–¹ä¾¿åæœŸç®¡ç†å’Œå¤ç°å®éªŒã€‚
  3. **å¯æ‰©å±•æ€§**ï¼šå¦‚æœä»¥åæƒ³å¯¹ä¸åŒçš„æ•°æ®é›†åšæ¨ç†ï¼Œå¯ä»¥å¤åˆ¶è¿™ä¸ªè„šæœ¬ï¼Œä¿®æ”¹å¯¹åº”çš„æ ‡è®°ï¼ˆå¦‚`dataset=xxx`ï¼‰å³å¯å¿«é€Ÿä½¿ç”¨ã€‚

- **è¿è¡Œæ–¹å¼**ï¼š

  1. åœ¨å‘½ä»¤è¡Œè¿›å…¥è¯¥è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œæˆ–è€…æ‚¨å¯ä»¥å°†è„šæœ¬æ”¾åœ¨ä»»ä½•æ‚¨å–œæ¬¢çš„ä½ç½®ï¼Œåªéœ€å¯¹åº”å³å¯ã€‚

  2. ä¿è¯è„šæœ¬å…·æœ‰æ‰§è¡Œæƒé™ï¼š

     ```
     ç‹‚æ¬¢
     
     
     å¤åˆ¶ç·¨è¼¯
     chmod +x run_crag_inference.sh
     ```

  3. æ‰§è¡Œè„šæœ¬ï¼š

     ```
     ç‹‚æ¬¢
     
     
     å¤åˆ¶ç·¨è¼¯
     ./run_crag_inference.sh
     ```

     æˆ–è€…ç”¨

     ```
     sh run_crag_inference.sh
     ```

     ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦åŠ å…¥æ­£ç¡®å’Œé”™è¯¯çŸ¥è¯†ä¸€èµ·è®­ç»ƒ



**æ­£ç¡®çŸ¥è¯†å’Œé”™è¯¯çŸ¥è¯†çš„ç»“åˆ**æœ‰åŠ©äºï¼š

1. **è®­ç»ƒæ¨¡å‹åŒºåˆ†æ­£ç¡®å’Œé”™è¯¯ä¿¡æ¯**ï¼ˆå¦‚QAã€æœç´¢å¼•æ“ä¼˜åŒ–ï¼‰ã€‚
2. **æé«˜NLPæ¨¡å‹çš„å¯¹æ¯”å­¦ä¹ èƒ½åŠ›**ï¼ˆå¦‚BERTã€GPTã€SimCSEï¼‰ã€‚
3. **å¸®åŠ©å¤„ç†æœ‰æ­§ä¹‰çš„ä¿¡æ¯**ï¼ˆå¦‚æ¨èç³»ç»Ÿã€ä¿¡æ¯æ£€ç´¢ï¼‰ã€‚
4. **ç”¨äºæ–‡æœ¬åˆ†ç±»æˆ–äº‹å®ä»»åŠ¡**ï¼ˆå¦‚å‡æ–°é—»æ£€æµ‹ï¼‰ã€‚

è¿™ç±»æ•°æ®å¯¹äº**æå‡AIåœ¨çœŸå®åœºæ™¯ä¸­çš„è¡¨ç°**éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯**é¿å…é”™è¯¯ä¼ æ’­**ã€‚





### ç›¸ä¼¼æ€§åšæ–‡ç« çš„åœ°æ–¹

![image-20250421205735441](../AppData/Roaming/Typora/typora-user-images/image-20250421205735441.png)

### å‡ ä¸ªæ£€ç´¢å™¨ç‰¹ç‚¹

 ğŸ”š æ€»ç»“å¯¹æ¯”



| æ–¹æ³•   | æ˜¯å¦è¯­ä¹‰ç†è§£ | æ˜¯å¦è®­ç»ƒæ¨¡å‹ | é€‚ç”¨åœºæ™¯       | ä¼˜ç‚¹                   | ç¼ºç‚¹           |
| ------ | ------------ | ------------ | -------------- | ---------------------- | -------------- |
| TF-IDF | âŒ            | âŒ            | å¿«é€Ÿæ–‡æœ¬åŒ¹é…   | å¿«ã€è½»é‡ã€å¯è§£é‡Š       | æ— æ³•ç†è§£è¯­ä¹‰   |
| BM25   | âŒ            | âŒ            | ç²¾å‡†å…³é”®è¯æœç´¢ | æ£€ç´¢å‡†ç¡®ã€å¹¿æ³›åº”ç”¨     | æ— è¯­ä¹‰ç†è§£èƒ½åŠ› |
| BGE    | âœ…            | âœ…            | å¤šè¯­è¨€è¯­ä¹‰æ£€ç´¢ | æ”¯æŒå¤šè¯­è¨€ï¼Œè¯­ä¹‰ç†è§£å¼º | å èµ„æºã€é»‘ç›’æ€§ |
| M3E    | âœ…            | âœ…            | ä¸­æ–‡è¯­ä¹‰æœç´¢   | ä¸­æ–‡è¯­ä¹‰ä¼˜ç§€ï¼Œæ¨¡å‹è¾ƒå° | è‹±æ–‡ä¸ä½³       |

------

å¦‚æœä½ åœ¨åšä¸€ä¸ª**æ£€ç´¢ç³»ç»Ÿï¼ˆæ¯”å¦‚ RAGã€FAQ ç­”é¢˜æœºå™¨äººï¼‰**ï¼š

- ğŸ” å¯¹å…³é”®è¯åŒ¹é…è¦æ±‚é«˜ï¼Œç”¨ **BM25 æˆ– TF-IDF**
- ğŸ§  è¿½æ±‚è¯­ä¹‰åŒ¹é…ç²¾åº¦ï¼Œæ¨è **BGE**ï¼ˆå¤šè¯­è¨€ï¼‰æˆ– **M3E**ï¼ˆä¸­æ–‡ï¼‰









# é¡¹ç›®

## 1.CRAG

### 1.è§£é‡Š

![image-20250314225733300](../AppData/Roaming/Typora/typora-user-images/image-20250314225733300.png)



ä»£ç è§£é‡Š

![image-20250314225558492](../AppData/Roaming/Typora/typora-user-images/image-20250314225558492.png)

### 2.tokenizer

train_data = tokenizer(
    data.content.to_list(),
    padding="max_length",
    max_length=512,
    truncation=True,
    return_tensors="pt"
)



    tokenizer = T5Tokenizer.from_pretrained("t5-large")
    model = T5ForSequenceClassification.from_pretrained("t5-large", num_labels=1)



**5. åŠ è½½æ¨¡å‹å’Œæ•°æ®**

```
pythonå¤åˆ¶ç¼–è¾‘    tokenizer = T5Tokenizer.from_pretrained("t5-large")
    model = T5ForSequenceClassification.from_pretrained("t5-large", num_labels=1)
```

- åŠ è½½ `T5Tokenizer` å’Œ `T5ForSequenceClassification`ï¼ˆT5çš„åˆ†ç±»ç‰ˆæœ¬ï¼Œè®¾ç½® `num_labels=1` è¿›è¡Œ**å›å½’ä»»åŠ¡**ï¼‰ã€‚

```
python


å¤åˆ¶ç¼–è¾‘
    train_data, train_label = data_preprocess(train_file, tokenizer)
```

- è°ƒç”¨ `data_preprocess` è·å–è®­ç»ƒæ•°æ® `train_data` å’Œ `train_label`ã€‚

```
pythonå¤åˆ¶ç¼–è¾‘    batch_size = 12
    train = TensorDataset(train_data["input_ids"], train_data["attention_mask"], torch.tensor(train_label))
    train_dataloader = DataLoader(train, batch_size=batch_size, shuffle=True, sampler=None)
```

- ç»„è£… `TensorDataset`ï¼ŒåŒ…æ‹¬ï¼š
  - `input_ids`ï¼ˆè¾“å…¥çš„token IDï¼‰
  - `attention_mask`ï¼ˆæ³¨æ„åŠ›æ©ç ï¼‰
  - `label`ï¼ˆæ ‡ç­¾ï¼‰
- ç”¨ `DataLoader` ç”Ÿæˆæ‰¹é‡æ•°æ®

```
pythonå¤åˆ¶ç¼–è¾‘    optimizer = AdamW(model.parameters(), lr=1e-4)
    num_epochs = 8
    num_training_steps = num_epochs * len(train_dataloader)
    lr_scheduler = get_scheduler(
        name="linear", optimizer=optimizer, num_warmup_steps=0, num_training_steps=num_training_steps
    )
```

- **ä¼˜åŒ–å™¨**ï¼šAdamWï¼ˆé€‚åˆ Transformer è®­ç»ƒï¼‰
- **å­¦ä¹ ç‡è°ƒåº¦å™¨**ï¼šçº¿æ€§ä¸‹é™ï¼ˆ`get_scheduler("linear")`ï¼‰

------

**6. æ¨¡å‹è®­ç»ƒ**

```
pythonå¤åˆ¶ç¼–è¾‘    device = torch.device("cuda:0") if torch.cuda.is_available() else torch.device("cpu")
    model.to(device)
```

- æ£€æµ‹æ˜¯å¦æœ‰å¯ç”¨çš„GPUï¼Œå¦‚æœæœ‰åˆ™ä½¿ç”¨ï¼Œå¦åˆ™ç”¨CPUã€‚

```
pythonå¤åˆ¶ç¼–è¾‘    for i, epoch in enumerate(range(num_epochs)):
        total_loss = 0
        model.train()
        for step, batch in enumerate(train_dataloader):
            if step % 10 == 0 and not step == 0:
                print("step: ",step, "  loss:",total_loss/(step*batch_size))
```

- è¿›å…¥è®­ç»ƒå¾ªç¯ï¼Œæ¯ `10` æ­¥æ‰“å°ä¸€æ¬¡ `loss`ã€‚

```
pythonå¤åˆ¶ç¼–è¾‘            b_input_ids = batch[0].to(device)
            b_input_mask = batch[1].to(device)
            b_labels = batch[2].to(device)

            model.zero_grad()        
            outputs = model(b_input_ids, attention_mask=b_input_mask, labels=b_labels)
            loss = outputs.loss   
            loss.mean().backward()
            total_loss += loss.mean().item()
            torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)

            optimizer.step()
            lr_scheduler.step()
            optimizer.zero_grad()
```

- **å‰å‘ä¼ æ’­**ï¼š
  - `model(b_input_ids, attention_mask=b_input_mask, labels=b_labels)`
- **è®¡ç®—æŸå¤±**ï¼š
  - `loss.mean().backward()`
- **æ¢¯åº¦è£å‰ª**ï¼š
  - é¿å…æ¢¯åº¦çˆ†ç‚¸ `torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)`
- **å‚æ•°æ›´æ–°**ï¼š
  - `optimizer.step()`
  - `lr_scheduler.step()`
  - `optimizer.zero_grad()`

------

 **7. ä¿å­˜æ¨¡å‹**

```
pythonå¤åˆ¶ç¼–è¾‘        avg_train_loss = total_loss / len(train_dataloader)      
        print("avg_loss:", avg_train_loss)

        model.save_pretrained(args.save_path + "/ep{}".format(i))
        tokenizer.save_pretrained(args.save_path + "/ep{}".format(i))
```

- æ¯ä¸ª `epoch` ç»“æŸåï¼Œä¿å­˜**æ¨¡å‹å’Œåˆ†è¯å™¨**ã€‚

------

**æ€»ç»“**

è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªå®Œæ•´çš„**æ–‡æœ¬å›å½’è®­ç»ƒè„šæœ¬**ï¼Œæ ¸å¿ƒåŠŸèƒ½ï¼š

1. è¯»å– `train_file` è®­ç»ƒæ•°æ®
2. ä½¿ç”¨ `T5Tokenizer` è¿›è¡Œæ–‡æœ¬ç¼–ç 
3. ä½¿ç”¨ `T5ForSequenceClassification` è¿›è¡Œæ¨¡å‹è®­ç»ƒ
4. ä½¿ç”¨ `AdamW` ä¼˜åŒ–å™¨ + `linear` å­¦ä¹ ç‡è°ƒåº¦å™¨
5. è®­ç»ƒè¿‡ç¨‹ä¸­æ‰“å° `loss`
6. æ¯ä¸ª `epoch` ç»“æŸåï¼Œä¿å­˜æ¨¡å‹å’Œåˆ†è¯å™¨



### 3.è®¡ç®—ä½™å¼¦

### 3. **å½’ä¸€åŒ–å¼ é‡**

Pythonå¤åˆ¶

```python
normalized_tensor_1 = tensor_1 / tensor_1.norm(dim=-1, keepdim=True)
normalized_tensor_2 = tensor_2 / tensor_2.norm(dim=-1, keepdim=True)
```

- è¿™é‡Œå¯¹è¾“å…¥çš„ä¸¤ä¸ªå¼ é‡åˆ†åˆ«è¿›è¡Œ **L2 å½’ä¸€åŒ–**ã€‚
- `tensor.norm(dim=-1, keepdim=True)`ï¼š
  - `dim=-1` è¡¨ç¤ºæ²¿ç€å¼ é‡çš„æœ€åä¸€ä¸ªç»´åº¦è®¡ç®— L2 èŒƒæ•°ï¼ˆå³æ¯ä¸ªå‘é‡çš„æ¨¡é•¿ï¼‰ã€‚
  - `keepdim=True` ä¿ç•™äº†ç»´åº¦ä¿¡æ¯ï¼Œä½¿å¾—å½’ä¸€åŒ–åçš„å¼ é‡å½¢çŠ¶ä¸åŸå§‹å¼ é‡ä¸€è‡´ã€‚
- å°†æ¯ä¸ªå¼ é‡é™¤ä»¥å®ƒçš„ L2 èŒƒæ•°ï¼Œä½¿å¾—æ¯ä¸ªå‘é‡çš„é•¿åº¦å˜ä¸º 1ï¼ˆå•ä½å‘é‡ï¼‰ã€‚





### 4.jsonlines

1. **å¤„ç†å¤§æ•°æ®é›†**ï¼šé€‚åˆå¤„ç†éå¸¸å¤§çš„æ•°æ®é›†ï¼Œå› ä¸ºå¯ä»¥é€è¡Œè¯»å–ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚
2. **æµå¼å¤„ç†**ï¼šå¯ä»¥ç”¨äºæµå¼æ•°æ®å¤„ç†ï¼Œä¾‹å¦‚ä»ç½‘ç»œæµä¸­é€è¡Œè¯»å– JSON æ•°æ®ã€‚

















# æ·±åº¦å­¦ä¹ ç›¸å…³åº“

## 1.pandas

### ä¸æ—¶é—´ç›¸å…³

**ç¤ºä¾‹ä»£ç è§£æï¼š**

```
train = pd.read_csv(DATA_PATH + 'train.csv', parse_dates=['date'])
```

- **`parse_dates=['date']`**ï¼šå°†åä¸º `'date'` çš„åˆ—è½¬æ¢ä¸º datetime ç±»å‹ã€‚
- è½¬æ¢åï¼Œ`train['date']` çš„æ•°æ®ç±»å‹ä¼šå˜ä¸º `datetime64[ns]`ï¼Œè€Œéå­—ç¬¦ä¸²ã€‚



1. **åç»­å¤„ç†æ›´é«˜æ•ˆ**
   è½¬æ¢ä¸º datetime ç±»å‹åï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æ—¶é—´åºåˆ—æ“ä½œï¼Œä¾‹å¦‚ï¼š
   - æŒ‰æ—¥æœŸç­›é€‰æ•°æ®ï¼š`df[df['date'] > '2023-01-01']`
   - æå–å¹´ã€æœˆã€æ—¥ï¼š`df['date'].dt.year`
   - è®¡ç®—æ—¶é—´å·®ï¼š`df['date'].diff()`
   - é‡é‡‡æ ·æ—¶é—´åºåˆ—ï¼š`df.resample('D', on='date').sum()`

### pandasæ‹¼æ¥ç”¨æ³•

**1. åˆå¹¶æ²¹ä»·æ•°æ®**

```
oil = oil.rename(columns={'dcoilwtico': 'oil_price'})
full_data = pd.concat([train, test], ignore_index=True)
full_data = pd.merge(full_data, oil, on='date', how='left')
```

- **`oil.rename`**ï¼šå°†æ²¹ä»·æ•°æ®ä¸­çš„åˆ—å `dcoilwtico`ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªç¼©å†™ï¼‰é‡å‘½åä¸ºæ›´æ˜“ç†è§£çš„ `oil_price`ã€‚
- **`pd.concat([train, test])`**ï¼šå°†è®­ç»ƒé›† `train` å’Œæµ‹è¯•é›† `test` çºµå‘æ‹¼æ¥ä¸ºä¸€ä¸ª DataFrame `full_data`ã€‚`ignore_index=True` è¡¨ç¤ºé‡ç½®ç´¢å¼•ï¼Œé¿å…ç´¢å¼•é‡å¤ã€‚
- **`pd.merge(full_data, oil)`**ï¼šå°†åˆå¹¶åçš„ `full_data` ä¸æ²¹ä»·æ•°æ® `oil` æŒ‰æ—¥æœŸåˆ— `date` è¿›è¡Œå·¦è¿æ¥ï¼ˆ`how='left'`ï¼‰ã€‚è¿™ä¸€æ­¥ä¼šä¸ºæ¯æ¡æ•°æ®æ·»åŠ å½“å¤©çš„æ²¹ä»·ä¿¡æ¯ã€‚

------

**2. åˆå¹¶å…¨å›½æ€§å‡æ—¥ä¿¡æ¯**

```
national_holidays = holidays[holidays['locale'] == 'National']
national_holidays = national_holidays[['date', 'type']].rename(columns={'type': 'holiday_type'})
full_data = pd.merge(full_data, national_holidays, on='date', how='left')
```

- **ç­›é€‰å…¨å›½æ€§å‡æ—¥**ï¼š`holidays[holidays['locale'] == 'National']` ä»åŸå§‹å‡æ—¥æ•°æ®ä¸­è¿‡æ»¤å‡ºå…¨å›½æ€§å‡æ—¥ï¼ˆæ’é™¤åœ°åŒºæ€§å‡æ—¥ï¼‰ã€‚
- **æå–å¿…è¦åˆ—å¹¶é‡å‘½å**ï¼š`national_holidays[['date', 'type']]` åªä¿ç•™æ—¥æœŸå’Œå‡æ—¥ç±»å‹åˆ—ï¼Œå¹¶å°† `type` é‡å‘½åä¸º `holiday_type`ï¼Œä½¿åˆ—åæ›´æ˜ç¡®ã€‚
- **å·¦è¿æ¥åˆå¹¶**ï¼šå°†å…¨å›½æ€§å‡æ—¥ä¿¡æ¯æŒ‰æ—¥æœŸåˆå¹¶åˆ° `full_data` ä¸­ï¼ŒéèŠ‚å‡æ—¥çš„æ—¥æœŸå¯¹åº”çš„ `holiday_type` ä¸º `NaN`ã€‚

### pandasè¿›è¡Œæ»åæ“ä½œ

```
def create_lag_features(df, lags=[1, 7, 14, 28]):
    for lag in lags:
        df[f'sales_lag_{lag}'] = df.groupby(['store_nbr', 'family'])['sales'].shift(lag)
    return df
```

1. **è¾“å…¥å‚æ•°**
   - `df`ï¼šåŒ…å«æ—¶é—´åºåˆ—æ•°æ®çš„ DataFrameï¼Œå¿…é¡»åŒ…å«åˆ— `date`ï¼ˆæ—¥æœŸï¼‰ã€`store_nbr`ï¼ˆå•†åº—ç¼–å·ï¼‰ã€`family`ï¼ˆå•†å“ç±»åˆ«ï¼‰ã€`sales`ï¼ˆé”€å”®é¢ï¼‰ã€‚
   - `lags`ï¼šæŒ‡å®šæ»åæ­¥é•¿çš„åˆ—è¡¨ï¼Œé»˜è®¤ä¸º `[1, 7, 14, 28]`ï¼Œè¡¨ç¤ºç”Ÿæˆè¿‡å» 1 å¤©ã€1 å‘¨ã€2 å‘¨ã€4 å‘¨çš„é”€å”®é¢ä½œä¸ºç‰¹å¾ã€‚
2. **æ ¸å¿ƒé€»è¾‘**
   - **æŒ‰åˆ†ç»„ç”Ÿæˆæ»åå€¼**ï¼š
     `groupby(['store_nbr', 'family'])` è¡¨ç¤ºæŒ‰å•†åº—å’Œå•†å“ç±»åˆ«åˆ†ç»„ï¼Œç¡®ä¿æ¯ä¸ªç»„å†…ç‹¬ç«‹è®¡ç®—æ»åå€¼ã€‚
     *ä¾‹å¦‚ï¼šå•†åº—Açš„é¥®æ–™ç±»å•†å“ä¸å•†åº—Bçš„é›¶é£Ÿç±»å•†å“çš„æ»åå€¼äº’ä¸å½±å“ã€‚*
   - **`shift(lag)`**ï¼š
     å¯¹æ¯ä¸ªç»„å†…çš„ `sales` åˆ—è¿›è¡Œæ»åæ“ä½œï¼Œå°†æ•°æ®å‘ä¸‹ç§»åŠ¨ `lag` è¡Œã€‚
     *ä¾‹å¦‚ï¼š`lag=1` æ—¶ï¼Œå½“å‰è¡Œçš„ `sales_lag_1` å€¼ä¸ºä¸Šä¸€è¡Œçš„ `sales`ã€‚*
3. **è¾“å‡ºç»“æœ**
   - ä¸ºæ¯ä¸ª `lag` ç”Ÿæˆæ–°åˆ—ï¼Œåˆ—åæ ¼å¼ä¸º `sales_lag_{lag}`ï¼ˆå¦‚ `sales_lag_7`ï¼‰ã€‚
   - è¿”å›æ›´æ–°åçš„ DataFrameã€‚

## 2. ChromaDB

ä¸‹é¢æŠŠ Chroma å¸¸ç”¨ä¸”â€œå¿…é¡»ä¼šâ€çš„ä¸œè¥¿æŒ‰ä¸»é¢˜ã€å¹¶é…ä¸ŠçŸ­ä»£ç ç¤ºä¾‹ã€å¸¸è§å‘ä¸æœ€ä½³å®è·µåˆ—å‡ºæ¥ã€‚å†…å®¹åŸºäºå®˜æ–¹æ–‡æ¡£ + ç¤¾åŒºå®è·µï¼Œå…³é”®äº‹å®æˆ‘åœ¨æ¯éƒ¨åˆ†ç»™å‡ºæ¥æºé“¾æ¥ï¼ˆä¾¿äºæŸ¥é˜…ï¼‰ã€‚å¦‚æœä½ æƒ³è¦æˆ‘æŠŠä¸‹é¢çš„ç¤ºä¾‹æ‰“åŒ…æˆä¸€ä¸ªå¯è¿è¡Œçš„ starter scriptï¼Œæˆ‘å¯ä»¥ç›´æ¥ç»™ä½ å®Œæ•´è„šæœ¬ã€‚

------

### æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆï¼ˆå…ˆè®°ä½è¿™äº›ï¼‰

- **Collection**ï¼šç›¸å½“äºä¸€å¼ è¡¨ï¼Œä¿å­˜å‘é‡ï¼ˆembeddingï¼‰ã€documentï¼ˆé€šå¸¸æ˜¯æ–‡æœ¬ chunkï¼‰å’Œ metadataã€‚[Chroma Docs](https://docs.trychroma.com/docs/querying-collections/query-and-get?utm_source=chatgpt.com)
- **Client ç±»å‹**ï¼šå¯é€‰å†…å­˜ï¼ˆEphemeral/Clientï¼‰ã€æœ¬åœ°æŒä¹…ï¼ˆPersistentClientï¼‰æˆ–é€šè¿‡ HTTP/Cloudï¼ˆHttpClient / CloudClientï¼‰è¿æ¥è¿œç«¯/Chroma Cloudã€‚æŒä¹…åŒ–ç›®å½•é€šå¸¸æ˜¯ `./chroma` æˆ–ä½ æŒ‡å®šçš„ `path`ã€‚[Chroma Docs+1](https://docs.trychroma.com/docs/run-chroma/persistent-client?utm_source=chatgpt.com)
- **ç´¢å¼•ï¼ˆIndexï¼‰**ï¼šChroma å†…éƒ¨ä½¿ç”¨ HNSWï¼ˆè¿‘ä¼¼æœ€è¿‘é‚»å›¾ï¼‰æ¥åšå‘é‡æ£€ç´¢ï¼Œç´¢å¼•é€šå¸¸éœ€è¦è¢«åŠ è½½åˆ°å†…å­˜ä¸­ä»¥è·å¾—é«˜æ€§èƒ½ã€‚ç´¢å¼•å‚æ•°å¯åœ¨ collection metadata ä¸­é…ç½®ï¼ˆå¦‚è·ç¦»ç©ºé—´ `l2`/`cosine`ã€Mã€ef_construction ç­‰ï¼‰ã€‚[Chroma Docs](https://docs.trychroma.com/guides/deploy/performance?utm_source=chatgpt.com)[cookbook.chromadb.dev](https://cookbook.chromadb.dev/core/configuration/?utm_source=chatgpt.com)

------

### 1) å®‰è£… & åˆå§‹åŒ–ï¼ˆPythonï¼‰

```
pip install chromadb
```

Python å¿«é€Ÿç¤ºä¾‹ï¼ˆæŒä¹…åŒ– clientï¼‰ï¼š

```
import chromadb
from chromadb.config import Settings

client = chromadb.PersistentClient(path="./chroma_db")  # æŒä¹…åŒ–åˆ°ç£ç›˜
collection = client.get_or_create_collection(
    name="kb",
    # å¯é€‰ï¼šä¼ å…¥ embedding functionï¼ˆè§åï¼‰
)
```

ï¼ˆæˆ– `client = chromadb.Client()`/`EphemeralClient()` åšä¸´æ—¶å†…å­˜æµ‹è¯•ï¼Œæˆ–ç”¨ `HttpClient`/`CloudClient` è¿æ¥è¿œç«¯/Cloudã€‚ï¼‰[Chroma Docs+1](https://docs.trychroma.com/docs/run-chroma/persistent-client?utm_source=chatgpt.com)

------

### 2) Embeddingï¼ˆåµŒå…¥ï¼‰çš„å¸¸è§ç”¨æ³•ï¼ˆä¸¤æ¡åŸåˆ™éå¸¸é‡è¦ï¼‰

1. **ç»´åº¦ä¸€è‡´**ï¼šä¸€ä¸ª collection çš„ embedding ç»´åº¦ä¸€æ—¦ç¬¬ä¸€æ¬¡å†™å…¥å°±è¢«â€œé”å®šâ€ï¼Œåç»­å†™å…¥æˆ–æŸ¥è¯¢å¿…é¡»ä½¿ç”¨ç›¸åŒç»´åº¦çš„å‘é‡ï¼ˆå¦åˆ™ä¼šæŠ¥é”™/è¡Œä¸ºå¼‚å¸¸ï¼‰ã€‚è¿™æ˜¯æœ€å¸¸è§çš„å‘ä¹‹ä¸€ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/faq/?utm_source=chatgpt.com)
2. **å½’ä¸€åŒ–**ï¼šé»˜è®¤è·ç¦»åº¦é‡æ˜¯ `l2`ï¼ˆæ¬§æ°ï¼‰ï¼Œå¦‚æœä½ ç”¨çš„ embedding æœªå½’ä¸€åŒ–ï¼Œè·ç¦»ä¼šéå¸¸å¤§ï¼Œå½±å“ç»“æœã€‚å¯¹ `L2` æˆ– `IP`ï¼ˆå†…ç§¯ï¼‰æ•æ„Ÿçš„åœºæ™¯ï¼Œ**å»ºè®®å…ˆå¯¹å‘é‡åš normalizeï¼ˆunit vectorï¼‰** æˆ–æ˜¾å¼è®¾å®š `hnsw:space` ä¸º `cosine`ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/faq/?utm_source=chatgpt.com)[realpython.com](https://realpython.com/chromadb-vector-database/?utm_source=chatgpt.com)

**å¦‚ä½•è®¾ç½® embedding function**ï¼ˆå¯è®© Chroma è‡ªåŠ¨åœ¨ add/query æ—¶è°ƒç”¨ï¼‰ï¼š

```
from chromadb.utils import embedding_functions
ef = embedding_functions.SentenceTransformerEmbeddingFunction(model_name="all-MiniLM-L6-v2")
collection = client.get_or_create_collection(name="kb", embedding_function=ef)
```

ä½ ä¹Ÿå¯ä»¥**è‡ªå·±è®¡ç®— embeddings**ï¼ˆæ¯”å¦‚ç”¨ OpenAIã€HuggingFaceã€æœ¬åœ°æ¨¡å‹ï¼‰å†æŠŠ embeddings ä¼ ç»™ `collection.add(..., embeddings=...)`ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/embeddings/bring-your-own-embeddings/?utm_source=chatgpt.com)[realpython.com](https://realpython.com/chromadb-vector-database/?utm_source=chatgpt.com)

------

### 3) å†™å…¥ï¼ˆadd / upsert / update / deleteï¼‰

- `collection.add(...)`ï¼šç”¨äºæ–°å¢ï¼ˆå¯èƒ½ä¼šè§¦å‘ DuplicateIDErrorï¼Œå¦‚æœ ids é‡å¤éœ€å¤„ç†ï¼‰ã€‚
- `collection.upsert(...)`ï¼š**æ¨èç”¨äºå¯é‡å¤æ‰§è¡Œçš„å†™å…¥æµç¨‹**ï¼Œä¼šæ›´æ–°å·²å­˜åœ¨ idï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ˆid å­˜åœ¨åˆ™æ›´æ–°ï¼‰ã€‚è¿™æ˜¯å®ç°å¹‚ç­‰å†™å…¥çš„å¸¸ç”¨æ–¹æ³•ã€‚[Chroma Docs+1](https://docs.trychroma.com/docs/collections/update-data?utm_source=chatgpt.com)

ç¤ºä¾‹ï¼ˆå¸¦ precomputed embeddingsï¼‰ï¼š

```
collection.add(
    ids=["doc1", "doc2"],
    documents=["æ–‡æœ¬A", "æ–‡æœ¬B"],
    metadatas=[{"source":"pdf"}, {"source":"web"}],
    embeddings=[[0.1,0.2,...], [0.2,0.3,...]]  # äº‹å…ˆè®¡ç®—å¥½çš„å‘é‡
)
# å¹‚ç­‰æ›´æ–°ï¼š
collection.upsert(
    ids=["doc1"],
    documents=["æ–‡æœ¬Aï¼ˆæ›´æ–°ï¼‰"],
    metadatas=[{"source":"pdf","version":2}],
    embeddings=[[...]]
)
```

**é¿å…é‡å¤ id çš„ç­–ç•¥**ï¼šåœ¨å†™å…¥å‰ç”¨ metadataï¼ˆå¦‚ file-hashï¼‰åšåˆ¤æ–­ï¼Œæˆ–ä½¿ç”¨ upsert ç›´æ¥è¦†ç›–ï¼Œæˆ–æ•è· `IDAlreadyExistsError`ã€‚ç¤¾åŒºå®è·µå¾ˆå¤šï¼ˆä¹Ÿè§ LangChain çš„å·®å¼‚æ³¨æ„ï¼‰ã€‚[Reddit](https://www.reddit.com/r/LangChain/comments/1abkaif/avoid_duplicates_inside_a_chroma_db/?utm_source=chatgpt.com)[Stack Overflow](https://stackoverflow.com/questions/76414862/how-do-you-catch-the-duplicate-id-error-when-using-langchain-vectorstores-chroma?utm_source=chatgpt.com)

------

### 4) æŸ¥è¯¢ï¼ˆquery / get / peekï¼‰ä¸è¿‡æ»¤

- `collection.query(...)`ï¼šç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆå¯ä¼  `query_texts` æˆ– `query_embeddings`ï¼‰ï¼Œæ”¯æŒ `n_results`ã€`where`ï¼ˆmetadata è¿‡æ»¤ï¼‰ç­‰å‚æ•°ã€‚
- `collection.get(ids=[...])`ï¼šæŒ‰ id ç²¾ç¡®è·å–è®°å½•ï¼ˆéç›¸ä¼¼æ£€ç´¢ï¼‰ã€‚
- `collection.peek(n)`ï¼šé¢„è§ˆ collection ä¸­å‰ n æ¡ï¼ˆè°ƒè¯•æ—¶éå¸¸æœ‰ç”¨ï¼‰ã€‚[Chroma Docs](https://docs.trychroma.com/docs/querying-collections/query-and-get?utm_source=chatgpt.com)

ç¤ºä¾‹ï¼š

```
# æ–‡æœ¬æŸ¥è¯¢ï¼ˆChroma ä¼šä½¿ç”¨ collection çš„ embedding_functionï¼‰
res = collection.query(query_texts=["å¦‚ä½•éƒ¨ç½²æ¨¡å‹ï¼Ÿ"], n_results=3)

# æˆ–åŸºäº embedding æŸ¥è¯¢
res = collection.query(query_embeddings=[[0.12,0.3,...]], n_results=5)

# å¸¦å…ƒæ•°æ®è¿‡æ»¤
res = collection.query(query_texts=["xxx"], n_results=5, where={"source":"pdf"})
```

**metadata è¿‡æ»¤æ”¯æŒçš„æ“ä½œç¬¦**ï¼ˆå¸¸ç”¨ï¼‰ï¼š`$eq`, `$in`, `$and`, `$or`, `$gt` ç­‰ï¼ˆè¯·å‚è€ƒ docs çš„ where æ–‡æ¡£ï¼‰ã€‚[Chroma Docs](https://docs.trychroma.com/docs/querying-collections/metadata-filtering?utm_source=chatgpt.com)

------

### 5) é«˜çº§æœç´¢ï¼šMMR / hybrid / re-rankingï¼ˆä¸ LangChain çš„å¸¸è§ç»„åˆï¼‰

- å¦‚æœä½ ç”¨ LangChain çš„ `Chroma` åŒ…è£…å™¨ï¼Œå¯ä»¥æŠŠ vectorstore å½“ä½œ retrieverï¼Œæ”¯æŒ `search_type="mmr"`ï¼ˆæœ€å¤§è¾¹é™…ç›¸å…³æ€§ï¼‰ä»¥åŠ `fetch_k`ã€`lambda_mult` ç­‰å‚æ•°æ¥å¹³è¡¡ç›¸å…³æ€§ä¸å¤šæ ·æ€§ï¼ˆMMRï¼‰ã€‚è¿™åœ¨ RAG åœºæ™¯å¾ˆå¸¸è§ã€‚[LangChain+1](https://python.langchain.com/docs/integrations/vectorstores/chroma/?utm_source=chatgpt.com)

ç¤ºä¾‹ï¼ˆLangChain retrieverï¼‰ï¼š

```
retriever = vector_store.as_retriever(
    search_type="mmr",
    search_kwargs={"k": 3, "fetch_k": 20, "lambda_mult": 0.5},
)
docs = retriever.get_relevant_documents("é—®é¢˜æ–‡æœ¬")
```

------

### 6) ç´¢å¼•ä¸æ€§èƒ½è°ƒä¼˜ï¼ˆHNSW å‚æ•° & å†…å­˜ï¼‰

- Chroma ä½¿ç”¨ HNSWï¼ˆforkï¼‰åšç´¢å¼•ã€‚HNSW çš„ç´¢å¼•éœ€è¦é©»ç•™åœ¨å†…å­˜ä¸­ä»¥è·å¾—é«˜æ€§èƒ½ï¼Œå› æ­¤å³ä¾¿ä½¿ç”¨ç£ç›˜æŒä¹…åŒ–ï¼ŒæŸ¥è¯¢æ—¶ä»æœ‰å†…å­˜è¦æ±‚ï¼ˆç´¢å¼•å¤§å°ä¸å‘é‡æ•°é‡ã€å‚æ•°æœ‰å…³ï¼‰ã€‚å¦‚æœä½ è¦å¤„ç†éå¸¸å¤§è§„æ¨¡ï¼ˆç™¾ä¸‡çº§ä»¥ä¸Šï¼‰å‘é‡ï¼Œéœ€è¦è¯„ä¼°å†…å­˜å’Œåˆ†ç‰‡ç­–ç•¥ï¼Œæˆ–è€ƒè™‘æ›´é¢å‘åˆ†å¸ƒå¼/å¤§è§„æ¨¡çš„å‘é‡åº“ï¼ˆå¦‚ Milvus ç­‰ï¼‰ã€‚[Chroma Docs](https://docs.trychroma.com/guides/deploy/performance?utm_source=chatgpt.com)[Zilliz](https://zilliz.com/blog/milvus-vs-chroma?utm_source=chatgpt.com)
- å¯ä»¥åœ¨åˆ›å»º collection æ—¶é€šè¿‡ metadata è®¾ç½® HNSW å‚æ•°ï¼Œä¾‹å¦‚ `{"hnsw:space":"cosine", "hnsw:m":16, "hnsw:ef_construction":200}`ï¼ˆä¸åŒç‰ˆæœ¬ API å¯èƒ½ç»†èŠ‚ç•¥æœ‰ä¸åŒï¼Œä¿®æ”¹åé€šå¸¸éœ€é‡å»ºç´¢å¼•æˆ– clone collectionï¼‰ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/core/configuration/?utm_source=chatgpt.com)

------

### 7) æŒä¹…åŒ–ã€å¤‡ä»½ä¸è¿ç§»

- **PersistentClient(path=...)** ä¼šæŠŠæ•°æ®å†™åˆ°ä½ æŒ‡å®šç›®å½•ï¼ˆé»˜è®¤ `./chroma`ï¼‰ï¼Œé‡å¯æ—¶ä¼šè‡ªåŠ¨åŠ è½½ã€‚é€‚åˆå•æœºæŒä¹…åŒ–ã€‚[Chroma Docs](https://docs.trychroma.com/docs/run-chroma/persistent-client?utm_source=chatgpt.com)
- åœ¨ notebook ä¸­å†™å…¥æ—¶ï¼Œæœ‰äº›ç‰ˆæœ¬éœ€è¦è°ƒç”¨ `client.persist()` æ¥å¼ºåˆ¶æŠŠå†…å­˜å†™åˆ°ç£ç›˜ï¼ˆä¸åŒç‰ˆæœ¬ API æœ‰å·®å¼‚ï¼›åœ¨æŸäº›ç‰ˆæœ¬ä¸­ persist æ–¹æ³•è¢«è°ƒæ•´/ç§»é™¤ï¼Œæ³¨æ„ä½ çš„ chroma ç‰ˆæœ¬ï¼‰ã€‚ä¸€èˆ¬è„šæœ¬é‡Œï¼Œclient è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨ flushã€‚å»ºè®®ï¼šå†™å®Œåæ£€æŸ¥ count / peekï¼Œå¹¶æ ¹æ®ä½ ç‰ˆæœ¬æ˜¯å¦æ”¯æŒæ˜¾å¼ persist å†³å®šæ˜¯å¦è°ƒç”¨ã€‚[Stack Overflow](https://stackoverflow.com/questions/77231763/cannot-load-persisted-db-using-chroma-langchain?utm_source=chatgpt.com)[GitHub](https://github.com/langchain-ai/langchain/issues/20851?utm_source=chatgpt.com)
- **å¤åˆ¶/å¯¼å‡º collection**ï¼šcookbook æä¾›æ•°æ®å¯¼å‡º/å¯¼å…¥ï¼ˆlocal <-> remoteï¼‰å’Œè¿ç§»å·¥å…·ï¼ˆä¹Ÿå¯ç”¨ cdp export/importï¼‰ã€‚ç”Ÿäº§ç¯å¢ƒå¸¸åšå®šæœŸå¤‡ä»½ï¼ˆå¤åˆ¶æŒä¹…ç›®å½•æˆ–ä½¿ç”¨ cdpï¼‰ã€‚[cookbook.chromadb.dev+1](https://cookbook.chromadb.dev/core/collections/?utm_source=chatgpt.com)

------

### 8) å¸¸è§å‘ã€è°ƒè¯•å»ºè®®ä¸æœ€ä½³å®è·µï¼ˆå¿…é¡»è®°ä½ï¼‰

1. **embedding ç»´åº¦ä¸ä¸€è‡´** â†’ ç›´æ¥æŠ¥é”™æˆ–æŸ¥è¯¢ç»“æœå¼‚å¸¸ã€‚ä¸Šä¼  embeddings å‰ç»Ÿä¸€æ¨¡å‹/ç»´åº¦ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/faq/?utm_source=chatgpt.com)
2. **æœªå½’ä¸€åŒ– embedding å¯¼è‡´å¤§è·ç¦»** â†’ å½’ä¸€åŒ–æˆ–è®¾ `hnsw:space="cosine"`ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/faq/?utm_source=chatgpt.com)
3. **id é‡å¤/å»é‡**ï¼š`add` å¯èƒ½äº§ç”Ÿ DuplicateIDErrorï¼Œ`upsert` æ›´é€‚åˆå¹‚ç­‰å†™å…¥ï¼Œæˆ–è‡ªå·±åœ¨å†™å…¥å‰ç”¨ metadata æŸ¥é‡ã€‚[Chroma Docs](https://docs.trychroma.com/reference/python/collection?utm_source=chatgpt.com)[Reddit](https://www.reddit.com/r/LangChain/comments/1abkaif/avoid_duplicates_inside_a_chroma_db/?utm_source=chatgpt.com)
4. **å†…å­˜ä¸è¶³**ï¼šHNSW ç´¢å¼•éœ€é©»ç•™å†…å­˜ï¼›å‘é‡æ•°é‡å¤§æ—¶è¯„ä¼°å†…å­˜/åˆ†ç‰‡/æ¢åº“ã€‚[Chroma Docs](https://docs.trychroma.com/guides/deploy/performance?utm_source=chatgpt.com)
5. **ç‰ˆæœ¬å·®å¼‚**ï¼šChroma çš„ API ä¼šæ›´æ–°ï¼ˆä¾‹å¦‚ persist çš„è¡Œä¸ºï¼‰ï¼Œåœ¨å‡çº§å‰çœ‹ changelog å¹¶åšæ•°æ®è¿ç§»æµ‹è¯•ã€‚[Chroma](https://www.trychroma.com/changelog?utm_source=chatgpt.com)[Chroma Docs](https://docs.trychroma.com/docs/overview/migration?utm_source=chatgpt.com)

------

### 9) å¸¸ç”¨ API é€ŸæŸ¥ï¼ˆä¸€è¡Œè¯´æ˜ + ç¤ºä¾‹ï¼‰

- åˆ›å»º clientï¼š`client = chromadb.Client()` / `PersistentClient(path="./chroma")`ã€‚[Chroma Docs](https://docs.trychroma.com/docs/run-chroma/persistent-client?utm_source=chatgpt.com)
- åˆ›å»º/è·å– collectionï¼š`collection = client.get_or_create_collection(name="kb", embedding_function=ef)`ã€‚[Chroma Docs](https://docs.trychroma.com/docs/collections/manage-collections?utm_source=chatgpt.com)
- addï¼ˆå¸¦ embeddingsï¼‰ï¼š`collection.add(ids=[...], documents=[...], metadatas=[...], embeddings=[...])`ã€‚[realpython.com](https://realpython.com/chromadb-vector-database/?utm_source=chatgpt.com)
- upsertï¼ˆæ›´æ–°æˆ–æ’å…¥ï¼‰ï¼š`collection.upsert(...)`ã€‚[Chroma Docs](https://docs.trychroma.com/docs/collections/update-data?utm_source=chatgpt.com)
- queryï¼š`collection.query(query_texts=["..."], n_results=5, where={...})` æˆ– `query_embeddings=[...]`ã€‚[Chroma Docs](https://docs.trychroma.com/docs/querying-collections/query-and-get?utm_source=chatgpt.com)
- get / peekï¼š`collection.get(ids=[...])` / `collection.peek(5)`ã€‚[ML EXPLAINED](https://mlexplained.blog/2024/04/09/ultimate-guide-to-chroma-vector-database-everything-you-need-to-know-part-2/?utm_source=chatgpt.com)
- deleteï¼š`collection.delete(ids=[...])` æˆ–ç”¨ where æ¡ä»¶åˆ é™¤ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/core/collections/?utm_source=chatgpt.com)

------

### 10) ä¸å…¶ä»–å·¥å…·/æ¡†æ¶æ•´åˆï¼ˆå¾ˆå¸¸ç”¨ï¼‰

- **LangChain**ï¼šå®˜æ–¹æœ‰ Chroma çš„æ•´åˆï¼ˆèƒ½ç›´æ¥æŠŠ Chroma å½“æˆ vectorstore / retriever ç”¨ï¼‰ï¼Œå¹¶æ”¯æŒ MMR ç­‰ç­–ç•¥ã€‚å¯¹ RAG + QA å¾ˆä¾¿åˆ©ã€‚[LangChain+1](https://python.langchain.com/docs/integrations/vectorstores/chroma/?utm_source=chatgpt.com)
- **LlamaIndex / Haystack / other**ï¼šéƒ½æœ‰ Chroma adapterï¼Œå¯ä»¥æŠŠ Chroma ä½œä¸ºåº•å±‚å‘é‡å­˜å‚¨ã€‚[LlamaIndex æ–‡æ¡£](https://docs.llamaindex.ai/en/stable/examples/vector_stores/ChromaIndexDemo/?utm_source=chatgpt.com)[Haystack Documentation](https://docs.haystack.deepset.ai/docs/chromadocumentstore?utm_source=chatgpt.com)

------

### 11) æ¨èçš„ç®€å•å·¥ç¨‹åŒ–æµç¨‹ï¼ˆPOC â†’ ç”Ÿäº§ï¼‰

1. POCï¼šåœ¨æœ¬åœ° `Client()` æˆ– `PersistentClient(path="./tmp")` åšå°è§„æ¨¡æµ‹è¯•ï¼Œä½¿ç”¨ç°æˆ embeddingï¼ˆsentence-transformers æˆ– OpenAIï¼‰ã€‚[realpython.com](https://realpython.com/chromadb-vector-database/?utm_source=chatgpt.com)
2. è®¾è®¡ chunk strategyï¼šæŠŠé•¿æ–‡æŒ‰åˆç†é•¿åº¦åˆ‡ç‰‡å¹¶å¸¦ä¸Šæ¥æº metadataï¼ˆfile_hashã€page_no ç­‰ï¼‰ã€‚[Medium](https://blog.amikos.tech/chroma-basics-document-primitive-d5a0c97cc813?utm_source=chatgpt.com)
3. å†™å…¥æ—¶ç”¨ `upsert` ä¿è¯å¯é‡è·‘ï¼›å†™å®Œç”¨ `peek/count` éªŒè¯ã€‚[Chroma Docs](https://docs.trychroma.com/docs/collections/update-data?utm_source=chatgpt.com)
4. æ€§èƒ½è¯„ä¼°ï¼šæµ‹ç´¢å¼•åœ¨å†…å­˜çš„å ç”¨ã€æŸ¥è¯¢å»¶è¿Ÿï¼Œæ ¹æ®éœ€è¦è°ƒæ•´ HNSW å‚æ•°æˆ–è€ƒè™‘åˆ†ç‰‡/æ›´æ¢æ•°æ®åº“ã€‚[Chroma Docs](https://docs.trychroma.com/guides/deploy/performance?utm_source=chatgpt.com)
5. å¤‡ä»½ & ç›‘æ§ï¼šå®šæœŸå¤‡ä»½ persist dirï¼Œå¹¶åœ¨å‡çº§å‰åš migration æµ‹è¯•ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/core/storage-layout/?utm_source=chatgpt.com)

------

### å‚è€ƒï¼ˆèŠ‚é€‰â€”â€”æˆ‘åœ¨æ­£æ–‡ä¸­å¼•ç”¨çš„æƒå¨èµ„æºï¼‰

- Chroma å®˜æ–¹å…¥é—¨ / Query ä¸ Collection æ–‡æ¡£ï¼ˆquery/get/metadata filteringï¼‰ã€‚[Chroma Docs+1](https://docs.trychroma.com/docs/querying-collections/query-and-get?utm_source=chatgpt.com)
- Chroma æ€§èƒ½è¯´æ˜ï¼ˆHNSW ç´¢å¼•éœ€åœ¨å†…å­˜ï¼‰ã€‚[Chroma Docs](https://docs.trychroma.com/guides/deploy/performance?utm_source=chatgpt.com)
- PersistentClient / client ç±»å‹ä¸æŒä¹…åŒ–è¯´æ˜ã€‚[Chroma Docs](https://docs.trychroma.com/docs/run-chroma/persistent-client?utm_source=chatgpt.com)
- FAQï¼ˆç»´åº¦é”å®šã€å‘é‡å½’ä¸€åŒ–ç­‰å¸¸è§é—®é¢˜ï¼‰ã€‚[cookbook.chromadb.dev](https://cookbook.chromadb.dev/faq/?utm_source=chatgpt.com)
- upsert/add è¡Œä¸ºä¸ collection API å‚è€ƒã€‚[Chroma Docs+1](https://docs.trychroma.com/docs/collections/update-data?utm_source=chatgpt.com)

------

### é¢å¤–ï¼šç»™ä½ çš„ä¸€ä»½æœ€å°åŒ– Python æ¨¡æ¿ï¼ˆå¯ç›´æ¥å¤åˆ¶è¿è¡Œï¼‰

ï¼ˆå¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æŠŠä¸‹é¢æ¨¡æ¿å®Œæ•´å±•å¼€æˆ `.py` æ–‡ä»¶å¹¶åŒ…å«è™šæ‹Ÿ embedding çš„ demo æ•°æ®ï¼‰

```
import chromadb
from chromadb.utils import embedding_functions

# 1. clientï¼ˆæŒä¹…åŒ–ï¼‰
client = chromadb.PersistentClient(path="./chroma_db_demo")

# 2. embedding functionï¼ˆå¯æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ï¼‰
ef = embedding_functions.SentenceTransformerEmbeddingFunction(model_name="all-MiniLM-L6-v2")

# 3. collectionï¼ˆè®¾ç½® HNSW ç©ºé—´ä¸º cosineï¼‰
collection = client.get_or_create_collection(
    name="demo_kb",
    embedding_function=ef,
    metadata={"hnsw:space": "cosine"}
)

# 4. åŠ å…¥æ–‡æ¡£ï¼ˆç¤ºä¾‹ï¼‰
collection.upsert(
    ids=["d1", "d2"],
    documents=["ç¬¬ä¸€æ®µæ–‡æœ¬å†…å®¹", "ç¬¬äºŒæ®µæ–‡æœ¬å†…å®¹"],
    metadatas=[{"source":"pdf","page":1}, {"source":"web","url":"https://..." }]
)

# 5. æŸ¥è¯¢
res = collection.query(query_texts=["æŸ¥è¯¢ç¤ºä¾‹"], n_results=3, where={"source":"pdf"})
print(res)

# 6. é¢„è§ˆä¸è®¡æ•°
print("count", collection.count())
print(collection.peek(3))
```

### 1. ChromaDB ä¸ LangChain çš„ç»“åˆæ–¹å¼

LangChain å·²ç»å†…ç½®äº†å¯¹ **Chroma** çš„æ”¯æŒï¼Œå¯ä»¥ç›´æ¥æŠŠå®ƒå½“ä½œ `VectorStore` ä½¿ç”¨ã€‚
 è¿™æ„å‘³ç€ä½ å¯ä»¥ï¼š

- ç”¨ LangChain æä¾›çš„ **æ–‡æ¡£åŠ è½½/åˆ‡åˆ† â†’ embedding â†’ å­˜å…¥ Chroma** æµç¨‹ï¼›
- æŠŠ Chroma å°è£…æˆ **Retriever**ï¼Œç›´æ¥ä½œä¸º RAG çš„çŸ¥è¯†åº“æŸ¥è¯¢ç»„ä»¶ã€‚

å…¸å‹æµç¨‹ï¼š

```
from langchain_community.vectorstores import Chroma
from langchain_openai import OpenAIEmbeddings

# 1. å®šä¹‰ embedding
embedding = OpenAIEmbeddings()

# 2. è¿æ¥ Chromaï¼ˆæŒä¹…åŒ–åˆ°æœ¬åœ°ç›®å½•ï¼‰
vectorstore = Chroma(
    collection_name="my_kb",
    embedding_function=embedding,
    persist_directory="./chroma_store"
)

# 3. æ·»åŠ æ–‡æ¡£
vectorstore.add_texts(
    texts=["ä½ å¥½ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¡æ–‡æœ¬", "è¿™æ˜¯ç¬¬äºŒæ¡æ–‡æœ¬"],
    metadatas=[{"source": "file1"}, {"source": "file2"}],
    ids=["id1", "id2"]
)

# 4. æ£€ç´¢ï¼ˆç›¸ä¼¼åº¦æœç´¢ï¼‰
docs = vectorstore.similarity_search("ä½ å¥½", k=2)

# 5. è½¬ Retrieverï¼ˆç”¨äºé“¾ï¼‰
retriever = vectorstore.as_retriever(
    search_type="mmr",   # æˆ– similarity
    search_kwargs={"k": 3, "fetch_k": 10, "lambda_mult": 0.5}
)
```

**æ€»ç»“ï¼š**

- `Chroma` åœ¨ LangChain ä¸­æ‰®æ¼” **å­˜å‚¨ + æ£€ç´¢** çš„è§’è‰²ã€‚
- `Retriever` æ˜¯ LangChain çš„ç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒå’Œå„ç§ LLM ç»„åˆï¼Œç›´æ¥åšé—®ç­”/å¯¹è¯ã€‚

------

### 2. å‚æ•°çš„å«ä¹‰

#### Chroma æ ¸å¿ƒå‚æ•°

- **collection_name**
  - å‘é‡åº“çš„é›†åˆåï¼ˆç›¸å½“äºä¸€å¼ è¡¨ï¼‰ï¼ŒåŒä¸€ä¸ªé›†åˆå†…ç»´åº¦å¿…é¡»ä¸€è‡´ã€‚
- **embedding_function**
  - å‘é‡ç”Ÿæˆå‡½æ•°ï¼Œå¯ä»¥ç”¨ OpenAI/HuggingFace/SentenceTransformers ç­‰ã€‚
- **persist_directory**
  - æ•°æ®æŒä¹…åŒ–è·¯å¾„ï¼Œå¦‚æœä¸å†™å°±æ˜¯å†…å­˜æ¨¡å¼ã€‚
- **ids**
  - æ¯ä¸ªå‘é‡çš„å”¯ä¸€æ ‡è¯†ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œé¿å…é‡å¤å†²çªã€‚
- **documents / texts**
  - åŸå§‹æ–‡æœ¬ï¼Œå¯ä»¥æ˜¯å¤§å—çš„æ–‡æ¡£åˆ‡ç‰‡ã€‚
- **metadatas**
  - æ¯ä¸ªå‘é‡çš„å…ƒæ•°æ®ï¼ˆå­—å…¸ï¼‰ï¼Œæ–¹ä¾¿åç»­è¿‡æ»¤ã€‚

------

#### Query / Search å‚æ•°

- **query_texts** / **query_embeddings**

  - ä½ è¦æŸ¥è¯¢çš„æ–‡æœ¬æˆ– embeddingã€‚

- **n_results / k**

  - è¿”å›çš„ top-k ç›¸ä¼¼ç»“æœã€‚

- **where**

  - metadata æ¡ä»¶è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼š

    ```
    where={"source": "pdf"}  
    where={"page": {"$gt": 10}}
    ```

------

#### Retriever å‚æ•°ï¼ˆLangChain å°è£…ï¼‰

- **search_type**
  - `"similarity"`ï¼šæŒ‰ç›¸ä¼¼åº¦è¿”å› top-k
  - `"mmr"`ï¼šæœ€å¤§è¾¹é™…ç›¸å…³æ€§ï¼ˆå‡å°‘é‡å¤ï¼Œä¿è¯å¤šæ ·æ€§ï¼‰
- **search_kwargs**ï¼ˆæ ¹æ® search_type ä¸åŒè€Œä¸åŒï¼‰ï¼š
  - `k`ï¼šæœ€ç»ˆè¿”å›çš„æ–‡æ¡£æ•°é‡
  - `fetch_k`ï¼šåˆå§‹å–å¤šå°‘ä¸ªå€™é€‰ï¼ˆMMR å¸¸ç”¨ï¼‰
  - `lambda_mult`ï¼šMMR ä¸­çš„å¤šæ ·æ€§æƒé‡ï¼ˆ0 åå‘ç›¸å…³æ€§ï¼Œ1 åå‘å¤šæ ·æ€§ï¼‰

------

### 3. metadata æ˜¯ä»€ä¹ˆï¼Ÿ

`metadata` å°±æ˜¯æ¯ä¸ªå‘é‡ç»‘å®šçš„ **é¢å¤–ä¿¡æ¯ï¼ˆé”®å€¼å¯¹å­—å…¸ï¼‰**ã€‚
 å®ƒä¸ä¼šè¿›å…¥ embeddingï¼Œä½†èƒ½å¸®åŠ©ä½ åš **è¿‡æ»¤ / æº¯æº / ä¸Šä¸‹æ–‡è¿½è¸ª**ã€‚

ä¸¾ä¾‹ï¼š
 ä½ æŠŠä¸€æœ¬ä¹¦åˆ†æˆå¾ˆå¤šæ®µè½ï¼Œå­˜è¿› Chromaï¼š

```
collection.add(
    ids=["para1", "para2"],
    documents=["ç¬¬ä¸€æ®µå†…å®¹...", "ç¬¬äºŒæ®µå†…å®¹..."],
    metadatas=[
        {"source": "book1.pdf", "page": 1},
        {"source": "book1.pdf", "page": 2}
    ]
)
```

ä¹‹åæŸ¥è¯¢æ—¶ï¼Œå¯ä»¥åŠ æ¡ä»¶ï¼š

```
res = collection.query(
    query_texts=["æŸä¸ªé—®é¢˜"],
    n_results=3,
    where={"source": "book1.pdf", "page": {"$gte": 2}}
)
```

**å¸¸è§ metadata ç”¨æ³•ï¼š**

- `source`ï¼šæ¥æºæ–‡ä»¶åï¼ˆpdf, docx, url â€¦ï¼‰
- `page`ï¼šæ‰€åœ¨é¡µæ•°
- `chunk_id`ï¼šåˆ†å—ç¼–å·
- `timestamp`ï¼šæ•°æ®æ’å…¥æ—¶é—´
- `version`ï¼šæ•°æ®ç‰ˆæœ¬

ä½œç”¨ï¼š

- å¯ä»¥åšæ¡ä»¶æ£€ç´¢ï¼ˆwhereï¼‰
- å¯ä»¥åœ¨æœ€ç»ˆå›ç­”æ—¶å‘Šè¯‰ç”¨æˆ·â€œè¿™æ®µè¯æ¥è‡ªå“ªä¸€é¡µå“ªä¸ªæ–‡ä»¶â€
- æ–¹ä¾¿åšæ•°æ®æ›´æ–°/å»é‡/è¿½è¸ª

------

âœ… æ€»ç»“ä¸€å¥è¯ï¼š

- **Chroma è´Ÿè´£å­˜å‚¨ + æ£€ç´¢**ï¼ŒLangChain æŠŠå®ƒåŒ…è£…æˆ **Retriever**ï¼Œæ–¹ä¾¿åœ¨ RAG é‡Œç›´æ¥è°ƒç”¨ã€‚
- **å‚æ•°**ä¸»è¦æ§åˆ¶å­˜å‚¨æ—¶ï¼ˆcollection, ids, embeddings, metadataï¼‰ã€æŸ¥è¯¢æ—¶ï¼ˆn_results, whereï¼‰ã€retriever ç­–ç•¥ï¼ˆsimilarity vs mmrï¼‰ã€‚
- **metadata** æ˜¯â€œä¸Šä¸‹æ–‡æ ‡ç­¾â€ï¼Œä¸å½±å“å‘é‡è®¡ç®—ï¼Œä½†èƒ½åšè¿‡æ»¤å’Œç»“æœè§£é‡Šï¼Œæ˜¯ RAG ç³»ç»Ÿä¸­éå¸¸é‡è¦çš„â€œæº¯æºä¿¡æ¯â€ã€‚





## 3. **jieba**

`jieba` æ˜¯ä¸€ä¸ªä¸­æ–‡åˆ†è¯åº“ï¼Œå¸¸ç”¨äºä¸­æ–‡æ–‡æœ¬çš„åˆ‡åˆ†å’Œå¤„ç†ã€‚å®ƒé€šè¿‡å°†ä¸­æ–‡å¥å­åˆ‡åˆ†æˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„è¯è¯­ï¼Œå¸®åŠ©è®¡ç®—æœºç†è§£ä¸­æ–‡æ–‡æœ¬çš„ç»“æ„ã€‚åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä¸­ï¼Œåˆ†è¯æ˜¯ä¸­æ–‡å¤„ç†ä¸­çš„åŸºç¡€æ­¥éª¤ã€‚

- **å®‰è£…**ï¼š

  ```
  bash
  
  
  å¤åˆ¶ç¼–è¾‘
  pip install jieba
  ```

- **å¸¸ç”¨åŠŸèƒ½**ï¼š

  - **ç²¾ç¡®æ¨¡å¼**ï¼šé»˜è®¤æ¨¡å¼ï¼Œæœ€é€‚åˆæ–‡æœ¬åˆ†æã€‚
  - **å…¨æ¨¡å¼**ï¼šæŠŠå¥å­ä¸­æ‰€æœ‰å¯èƒ½çš„è¯è¯­éƒ½æ‰«æå‡ºæ¥ï¼Œé€Ÿåº¦éå¸¸å¿«ï¼Œä½†ä¸èƒ½è§£å†³æ­§ä¹‰ã€‚
  - **æœç´¢å¼•æ“æ¨¡å¼**ï¼šé€‚ç”¨äºæœç´¢å¼•æ“æ„å»ºï¼Œç²’åº¦æ¯”ç²¾ç¡®æ¨¡å¼æ›´ç»†ã€‚

### 2. **cut_for_search**

`cut_for_search` æ˜¯ `jieba` ä¸­çš„ä¸€ä¸ªåˆ†è¯æ–¹æ³•ï¼Œé€‚ç”¨äºå°†æ–‡æœ¬åˆ‡åˆ†ä¸ºæœç´¢å¼•æ“å‹å¥½çš„ç»†ç²’åº¦è¯æ±‡ã€‚å®ƒä¼šå°†å¥å­åˆ†å‰²æˆæ¯”ç²¾ç¡®æ¨¡å¼æ›´ç»†çš„ç²’åº¦ï¼Œä»¥é€‚åº”æœç´¢å¼•æ“ä¸­å…³é”®è¯åŒ¹é…çš„éœ€æ±‚ã€‚

- **ç”¨æ³•**ï¼š

  ```
  pythonå¤åˆ¶ç¼–è¾‘import jieba
  text = "æˆ‘æ¥åˆ°åŒ—äº¬æ¸…åå¤§å­¦"
  result = jieba.cut_for_search(text)
  print(" ".join(result))
  ```

  è¾“å‡ºï¼š

  ```
  å¤åˆ¶ç¼–è¾‘
  æˆ‘ æ¥åˆ° åŒ—äº¬ æ¸…å å¤§å­¦
  ```

  - è¿™ç§æ–¹å¼åˆ‡åˆ†å‡ºæ¥çš„è¯æ±‡æ¯”è¾ƒç»†ï¼Œä¾‹å¦‚â€œæ¸…åå¤§å­¦â€è¢«æ‹†æˆäº†â€œæ¸…åâ€å’Œâ€œå¤§å­¦â€ï¼Œè¿™æ˜¯å› ä¸ºæœç´¢å¼•æ“ä¼šç”¨åˆ°è¿™äº›ç»†ç²’åº¦çš„å…³é”®è¯æ¥æé«˜åŒ¹é…çš„å‡†ç¡®æ€§ã€‚

## 4. Embeddingæ¨¡å‹é€‰æ‹©

![image-20250731185516271](../AppData/Roaming/Typora/typora-user-images/image-20250731185516271.png)













# åŒ»å­¦

## RAG

### ä¸€äº›æ–‡çŒ®

![image-20250508172717363](../AppData/Roaming/Typora/typora-user-images/image-20250508172717363.png)

### çŸ¥è¯†å›¾è°±

![image-20250603163838384](../AppData/Roaming/Typora/typora-user-images/image-20250603163838384.png)

æ•°æ®é›†æ¥æº

![image-20250525001846113](../AppData/Roaming/Typora/typora-user-images/image-20250525001846113.png)

èŠ‚ç‚¹å…³ç³»

![image-20250525001941639](../AppData/Roaming/Typora/typora-user-images/image-20250525001941639.png)

åˆ«äººçš„æƒ³æ³•

![image-20250525002102219](../AppData/Roaming/Typora/typora-user-images/image-20250525002102219.png)

### è®ºæ–‡

![image-20250525205105062](../AppData/Roaming/Typora/typora-user-images/image-20250525205105062.png)









# ç®—æ³•

## å¤šæ¨¡æ€

### clip

#### ç®€ä»‹

##### 1. é¢„è®­ç»ƒåï¼šâ€œæ–‡æœ¬-å›¾åƒé…å¯¹â€æ€ç»´çš„å½¢æˆ

åœ¨é¢„è®­ç»ƒé˜¶æ®µï¼Œæ¨¡å‹çœ‹äº†**4äº¿ä¸ªï¼ˆå›¾åƒï¼Œæ–‡æœ¬æè¿°ï¼‰å¯¹**ã€‚
*   **å®ƒå­¦åˆ°çš„ä¸œè¥¿**ï¼šå¹¶ä¸æ˜¯ç®€å•åœ°è®¤è¯†â€œç‹—â€æˆ–â€œæ±½è½¦â€è¿™ä¸ªç±»åˆ«æ ‡ç­¾ï¼Œè€Œæ˜¯å­¦ä¹ åˆ°äº† **â€œæŸä¸€æ®µæ–‡å­—æè¿°ï¼ˆå¦‚â€˜ä¸€åªåœ¨è‰åªä¸Šå¥”è·‘çš„ç‹—â€™ï¼‰åœ¨è§†è§‰ä¸Šåº”è¯¥å¯¹åº”ä»€ä¹ˆæ ·çš„å›¾åƒç‰¹å¾â€** ï¼Œåä¹‹äº¦ç„¶ã€‚
*   **å½¢æˆçš„æœºåˆ¶**ï¼šæ¨¡å‹å†…éƒ¨å»ºç«‹äº†ä¸€ä¸ª**å…±äº«çš„è¯­ä¹‰ç©ºé—´**ã€‚åœ¨è¿™ä¸ªç©ºé—´é‡Œï¼Œâ€œç‹—çš„å›¾ç‰‡â€çš„ç‰¹å¾å‘é‡å’Œâ€œæè¿°ç‹—çš„æ–‡æœ¬â€çš„ç‰¹å¾å‘é‡éå¸¸æ¥è¿‘ï¼Œä½†å’Œâ€œæè¿°æ±½è½¦çš„æ–‡æœ¬â€çš„ç‰¹å¾å‘é‡åˆ™å¾ˆè¿œã€‚

---

##### 2. â€œè‡ªç„¶è¯­è¨€è¢«ç”¨æ¥å¼•ç”¨å­¦ä¹ åˆ°çš„è§†è§‰æ¦‚å¿µâ€

è¿™æ˜¯æŒ‡åœ¨**åšä¸‹æ¸¸ä»»åŠ¡æ—¶ï¼ˆæ¯”å¦‚å›¾åƒåˆ†ç±»ï¼‰**ï¼Œæˆ‘ä»¬å¦‚ä½•â€œå”¤é†’â€æ¨¡å‹åœ¨é¢„è®­ç»ƒä¸­å­¦åˆ°çš„çŸ¥è¯†ã€‚

**ä¼ ç»Ÿæ¨¡å‹çš„åšæ³•**ï¼šç»™ä½ ä¸€å¼ å›¾ï¼Œæ¨¡å‹ä»1000ä¸ªå›ºå®šçš„ç±»åˆ«ï¼ˆå¦‚â€œè´µå®¾çŠ¬â€ã€â€œå‰å¨ƒå¨ƒâ€ï¼‰ä¸­é€‰ä¸€ä¸ªè¾“å‡ºã€‚è¿™äº›ç±»åˆ«æ˜¯è®­ç»ƒæ—¶å®šæ­»çš„ç¡¬ç¼–ç æ•°å­—ã€‚

**CLIPçš„åšæ³•**ï¼š
1.  **æŠŠåˆ†ç±»ä»»åŠ¡å˜æˆå›¾æ–‡åŒ¹é…ä»»åŠ¡**ï¼šæˆ‘ä»¬ä¸ç”¨æ•°å­—æ ‡ç­¾ï¼Œè€Œæ˜¯ç”¨**è‡ªç„¶è¯­è¨€æè¿°**æ¥å®šä¹‰ç±»åˆ«ã€‚
2.  **å¼•ç”¨æ¦‚å¿µ**ï¼šæ¯”å¦‚ï¼Œæˆ‘ä»¬è¦åˆ†ç±»â€œç‹—â€ã€â€œçŒ«â€ã€â€œæ±½è½¦â€ã€‚æˆ‘ä»¬ä¸å‘Šè¯‰æ¨¡å‹ç±»åˆ«ç¼–å·0ï¼Œ1ï¼Œ2ï¼Œè€Œæ˜¯ç»™å®ƒ**ä¸€ä¸²æ–‡å­—æç¤ºï¼ˆPromptsï¼‰**ï¼Œä¾‹å¦‚ï¼š
    *   `â€œä¸€å¼ ç‹—çš„ç…§ç‰‡â€`
    *   `â€œä¸€å¼ çŒ«çš„ç…§ç‰‡â€`
    *   `â€œä¸€è¾†æ±½è½¦çš„ç…§ç‰‡â€`
3.  **æ¨¡å‹å¦‚ä½•å·¥ä½œ**ï¼š
    *   CLIPçš„**æ–‡æœ¬ç¼–ç å™¨**ä¼šæŠŠè¿™äº›æ–‡æœ¬æç¤ºè½¬æ¢æˆç‰¹å¾å‘é‡ï¼ˆ`T_dog`, `T_cat`, `T_car`ï¼‰ã€‚
    *   CLIPçš„**å›¾åƒç¼–ç å™¨**ä¼šæŠŠå¾…åˆ†ç±»çš„å›¾ç‰‡è½¬æ¢æˆç‰¹å¾å‘é‡ï¼ˆ`I`ï¼‰ã€‚
    *   æ¨¡å‹è®¡ç®—å›¾ç‰‡å‘é‡`I`ä¸æ¯ä¸€ä¸ªæ–‡æœ¬å‘é‡ï¼ˆ`T_dog`ç­‰ï¼‰çš„ç›¸ä¼¼åº¦ã€‚
    *   é€‰æ‹©ç›¸ä¼¼åº¦æœ€é«˜çš„é‚£ä¸ªæ–‡æœ¬æ ‡ç­¾ä½œä¸ºé¢„æµ‹ç»“æœã€‚
    *   **å…³é”®**ï¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–‡æœ¬æç¤º `â€œä¸€å¼ ç‹—çš„ç…§ç‰‡â€` **å°±åƒä¸€æŠŠé’¥åŒ™ï¼Œæ¿€æ´»ï¼ˆå¼•ç”¨ï¼‰äº†æ¨¡å‹åœ¨é¢„è®­ç»ƒæ—¶å­¦åˆ°çš„æ‰€æœ‰å…³äºâ€œç‹—â€çš„è§†è§‰æ¦‚å¿µ**ã€‚

---

##### 3. â€œæˆ–æè¿°æ–°çš„æ¦‚å¿µâ€â€”â€”é›¶æ ·æœ¬èƒ½åŠ›çš„æ ¸å¿ƒ

è¿™æ‰æ˜¯CLIPæœ€å¼ºå¤§çš„åœ°æ–¹ã€‚**ä¸‹æ¸¸ä»»åŠ¡ä¸­çš„ç±»åˆ«ï¼Œå®Œå…¨å¯ä»¥ä¸åœ¨é¢„è®­ç»ƒæ•°æ®ä¸­æ˜ç¡®å‡ºç°è¿‡ï¼**

**ä¸¾ä¸ªä¾‹å­**ï¼š
å‡è®¾CLIPåœ¨é¢„è®­ç»ƒæ—¶ä»æœªæ˜ç¡®è§è¿‡â€œæ–°å† æ£€æµ‹è¯•å‰‚ç›’â€çš„å›¾ç‰‡å’Œæ–‡å­—ï¼Œä½†å®ƒè§è¿‡â€œè¯•çº¸â€ã€â€œä¸¤æ¡çº¿â€ã€â€œå¡‘æ–™å¤–å£³â€ã€â€œåŒ»å­¦æ£€æµ‹â€ç­‰æ— æ•°ç›¸å…³æ¦‚å¿µã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³åšä¸€ä¸ªâ€œè¯†åˆ«æ–°å† æ£€æµ‹ç»“æœâ€çš„ä»»åŠ¡ã€‚ä¼ ç»Ÿæ¨¡å‹éœ€è¦æ”¶é›†å¤§é‡è¯•å‰‚ç›’å›¾ç‰‡é‡æ–°è®­ç»ƒã€‚è€ŒCLIPå¯ä»¥ç›´æ¥ç”¨è‡ªç„¶è¯­è¨€**æè¿°è¿™ä¸ªæ–°æ¦‚å¿µ**ï¼š
*   Prompt 1: `â€œä¸€å¼ æ˜¾ç¤ºæ–°å† é˜³æ€§ç»“æœçš„æ£€æµ‹è¯•å‰‚ç›’ç…§ç‰‡â€`
*   Prompt 2: `â€œä¸€å¼ æ˜¾ç¤ºæ–°å† é˜´æ€§ç»“æœçš„æ£€æµ‹è¯•å‰‚ç›’ç…§ç‰‡â€`
*   Prompt 3: `â€œä¸€å¼ æ— æ•ˆçš„æ–°å† æ£€æµ‹è¯•å‰‚ç›’ç…§ç‰‡â€`

**æ¨¡å‹å¦‚ä½•å·¥ä½œ**ï¼š
æ¨¡å‹è™½ç„¶æ²¡æœ‰ç›´æ¥èƒŒä¸‹â€œè¯•å‰‚ç›’â€è¿™ä¸ªç±»åˆ«ï¼Œä½†å®ƒç†è§£ï¼š
*   `â€œé˜³æ€§â€`å¯èƒ½å…³è”`â€œä¸¤æ¡çº¿â€`ã€`â€œçº¢è‰²æ ‡è®°â€`ç­‰è§†è§‰ç‰¹å¾ã€‚
*   `â€œæ£€æµ‹â€`å…³è”`â€œå¡‘æ–™è£…ç½®â€`ã€`â€œè¯•çº¸â€`ã€‚
*   `â€œæ— æ•ˆâ€`å¯èƒ½å…³è”`â€œæ¨¡ç³Šâ€`ã€`â€œåªæœ‰ä¸€æ¡æ§åˆ¶çº¿â€`ã€‚

é€šè¿‡**ç»„åˆè¿™äº›å·²æœ‰çš„è§†è§‰-è¯­è¨€æ¦‚å¿µ**ï¼Œæ¨¡å‹å°±èƒ½åœ¨å…±äº«è¯­ä¹‰ç©ºé—´ä¸­ï¼Œå°†æ–°çš„å›¾ç‰‡ä¸è¿™äº›æ–°çš„æ–‡æœ¬æè¿°è¿›è¡Œæ¯”è¾ƒï¼Œåšå‡ºåˆç†åˆ¤æ–­ã€‚**è¿™å°±æ˜¯â€œæè¿°æ–°æ¦‚å¿µâ€**ã€‚

---

##### ç”¨ä¸€ä¸ªå®Œæ•´æ¯”å–»æ¥æ€»ç»“

æƒ³è±¡CLIPåœ¨é¢„è®­ç»ƒé˜¶æ®µæ˜¯ä¸€ä¸ª**åšè§ˆç¾¤ä¹¦ï¼ˆ4äº¿å¯¹å›¾æ–‡ï¼‰çš„é€šæ‰**ï¼Œå®ƒä¸èƒŒæ­»ç­”æ¡ˆï¼Œè€Œæ˜¯å»ºç«‹äº†å¼ºå¤§çš„â€œå›¾æ–‡è”æƒ³â€èƒ½åŠ›ã€‚

å½“é‡åˆ°ä¸€ä¸ªæ–°é—®é¢˜ï¼ˆä¸‹æ¸¸ä»»åŠ¡ï¼‰æ—¶ï¼š
1.  **ä¼ ç»Ÿä¸“å®¶æ¨¡å‹**ï¼šéœ€è¦ä½ ç»™å®ƒä¸Šä¸“é—¨çš„åŸ¹è®­è¯¾ï¼ˆå¾®è°ƒï¼‰ï¼Œæ•™å®ƒè®¤è¯†è¿™ä¸ªæ–°é¢†åŸŸçš„ä¸“ç”¨æœ¯è¯­ï¼ˆå›ºå®šç±»åˆ«æ ‡ç­¾ï¼‰ã€‚
2.  **CLIPè¿™ä¸ªé€šæ‰**ï¼šä½ ä¸éœ€è¦é‡æ–°åŸ¹è®­å®ƒã€‚ä½ åªéœ€è¦ç”¨**å®ƒå·²ç»æŒæ¡çš„äººç±»è¯­è¨€**ï¼Œå‘å®ƒ**æè¿°**è¿™ä¸ªæ–°ä»»åŠ¡æ˜¯ä»€ä¹ˆã€‚
    *   **â€œå¼•ç”¨â€**ï¼šå°±åƒä½ é—®å®ƒï¼šâ€œè¿˜è®°å¾—ä¹¦é‡Œæåˆ°çš„â€˜æŸ¯åŸºçŠ¬â€™å—ï¼Ÿâ€ï¼ˆç”¨å·²çŸ¥æ¦‚å¿µï¼‰ã€‚
    *   **â€œæè¿°æ–°çš„â€**ï¼šå°±åƒä½ é—®å®ƒï¼šâ€œå¦‚æœä¸€ä¸ªç‰©ä½“æ˜¯é€æ˜çš„ã€æœ‰å››ä¸ªè½®å­ã€é ç”µåŠ›é©±åŠ¨ï¼Œå®ƒå¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼ˆç»„åˆå·²çŸ¥æ¦‚å¿µï¼Œå®šä¹‰æ–°äº‹ç‰©ï¼‰ã€‚

è¿™ä¸ªé€šæ‰å°±èƒ½åŸºäºå®ƒåºå¤§çš„çŸ¥è¯†åº“å’Œå¼ºå¤§çš„è”æƒ³èƒ½åŠ›ï¼Œç»™å‡ºç­”æ¡ˆã€‚**è¿™å°±æ˜¯é›¶æ ·æœ¬è¿ç§»**â€”â€”æ¨¡å‹è¿ç§»çš„ä¸æ˜¯æŸä¸ªå…·ä½“ä»»åŠ¡çš„å‚æ•°ï¼Œè€Œæ˜¯è¿ç§»äº†**ç”¨è¯­è¨€ç†è§£å’Œè¿æ¥è§†è§‰ä¸–ç•Œçš„åŸºç¡€èƒ½åŠ›**ã€‚



#### **è®­ç»ƒæµç¨‹è¯¦è§£**

##### **ç¬¬1æ­¥ï¼šå‡†å¤‡æµ·é‡â€œå›¾æ–‡å¯¹â€æ•°æ®**

- **æ•°æ®æ¥æº**ï¼šä»äº’è”ç½‘ä¸Šçˆ¬å–4äº¿ä¸ªï¼ˆå›¾åƒï¼Œæ–‡æœ¬æè¿°ï¼‰å¯¹ã€‚æ–‡æœ¬å°±æ˜¯å›¾ç‰‡çš„åŸå§‹è¯´æ˜ã€æ ‡é¢˜æˆ–ALTæ–‡æœ¬ã€‚
- **ç‰¹ç‚¹**ï¼šæ•°æ®æ˜¯â€œå™ªå£°â€çš„â€”â€”æè¿°ä¸ä¸€å®šç²¾ç¡®ï¼Œä½†è¶³å¤Ÿä¸°å¯Œå’Œå¤šæ ·ã€‚è¿™è¿«ä½¿æ¨¡å‹å»ç†è§£è¯­ä¹‰ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒã€‚

##### **ç¬¬2æ­¥ï¼šæ„å»ºâ€œæ‰¹æ¬¡â€å¹¶è¿›è¡Œç¼–ç **

1. éšæœºæŠ½å–ä¸€ä¸ªæ‰¹æ¬¡çš„Nä¸ªå›¾æ–‡å¯¹ï¼Œä¾‹å¦‚ N=1024ã€‚
2. **å›¾åƒç¼–ç **ï¼šå°†Nå¼ å›¾ç‰‡è¾“å…¥**å›¾åƒç¼–ç å™¨**ï¼ˆå¯ä»¥æ˜¯Vision Transformeræˆ–ResNetï¼‰ï¼Œå¾—åˆ°Nä¸ªå›¾åƒç‰¹å¾å‘é‡ `[I1, I2, ..., IN]`ã€‚
3. **æ–‡æœ¬ç¼–ç **ï¼šå°†å¯¹åº”çš„Næ¡æ–‡æœ¬è¾“å…¥**æ–‡æœ¬ç¼–ç å™¨**ï¼ˆä¸€ä¸ªTransformerï¼‰ï¼Œå¾—åˆ°Nä¸ªæ–‡æœ¬ç‰¹å¾å‘é‡ `[T1, T2, ..., TN]`ã€‚

##### **ç¬¬3æ­¥ï¼šè®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ**

- è®¡ç®—**æ‰€æœ‰å›¾åƒç‰¹å¾**å’Œ**æ‰€æœ‰æ–‡æœ¬ç‰¹å¾**ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¾—åˆ°ä¸€ä¸ª `N x N` çš„çŸ©é˜µã€‚
- **çŸ©é˜µå¯¹è§’çº¿**ä¸Šçš„å…ƒç´  `(I1, T1), (I2, T2)...` æ˜¯**æ­£æ ·æœ¬å¯¹**ï¼ˆå®ƒä»¬æœ¬æ¥å°±æ˜¯é…å¯¹çš„ï¼‰ã€‚
- **çŸ©é˜µéå¯¹è§’çº¿**ä¸Šçš„å…ƒç´ éƒ½æ˜¯**è´Ÿæ ·æœ¬å¯¹**ï¼ˆæ¯”å¦‚ `I1` å’Œ `T2`ï¼Œå›¾ç‰‡å’Œæ–‡å­—ä¸åŒ¹é…ï¼‰ã€‚

##### **ç¬¬4æ­¥ï¼šé€šè¿‡å¯¹æ¯”æŸå¤±å‡½æ•°è¿›è¡Œä¼˜åŒ–**

è¿™æ˜¯è®­ç»ƒçš„å…³é”®ã€‚ç›®æ ‡å¾ˆç›´è§‚ï¼š

- **æ‹‰è¿‘æ­£æ ·æœ¬**ï¼šè®©å¯¹è§’çº¿ä¸Šçš„ç›¸ä¼¼åº¦å°½å¯èƒ½é«˜ã€‚
- **æ¨å¼€è´Ÿæ ·æœ¬**ï¼šè®©éå¯¹è§’çº¿ä¸Šçš„ç›¸ä¼¼åº¦å°½å¯èƒ½ä½ã€‚

è¿™é€šè¿‡ä¸€ä¸ªå«**å¯¹ç§°äº¤å‰ç†µæŸå¤±** æ¥å®ç°ï¼š

- **å›¾åƒâ†’æ–‡æœ¬åˆ†ç±»**ï¼šå¯¹äºæ¯ä¸€å¼ å›¾ç‰‡ `I_i`ï¼ŒæŠŠNæ¡æ–‡æœ¬å½“ä½œNä¸ªâ€œç±»åˆ«â€ï¼Œè®¡ç®—ä¸€ä¸ªSoftmaxåˆ†ç±»æŸå¤±ã€‚å”¯ä¸€çš„æ­£ç¡®â€œç±»åˆ«â€å°±æ˜¯å…¶é…å¯¹çš„æ–‡æœ¬ `T_i`ã€‚
- **æ–‡æœ¬â†’å›¾åƒåˆ†ç±»**ï¼šåŒç†ï¼Œå¯¹äºæ¯ä¸€æ¡æ–‡æœ¬ `T_i`ï¼ŒæŠŠNå¼ å›¾ç‰‡å½“ä½œNä¸ªâ€œç±»åˆ«â€ï¼Œå”¯ä¸€çš„æ­£ç¡®â€œç±»åˆ«â€æ˜¯å…¶é…å¯¹çš„å›¾ç‰‡ `I_i`ã€‚
- **æ€»æŸå¤±**æ˜¯è¿™ä¸¤ä¸ªæ–¹å‘æŸå¤±çš„å¹³å‡ã€‚è¿™å°±æ˜¯â€œå¯¹ç§°â€çš„å«ä¹‰ï¼Œç¡®ä¿å›¾æ–‡ç†è§£æ˜¯åŒå‘å¯¹é½çš„ã€‚

##### **ç¬¬5æ­¥ï¼šåå‘ä¼ æ’­ä¸è¿­ä»£**

- è®¡ç®—å‡ºçš„æ€»æŸå¤±é€šè¿‡åå‘ä¼ æ’­ï¼ŒåŒæ—¶æ›´æ–°**å›¾åƒç¼–ç å™¨**å’Œ**æ–‡æœ¬ç¼–ç å™¨**çš„å‚æ•°ã€‚
- ç”¨æ–°çš„æ‰¹æ¬¡é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œåœ¨æ•°äº¿çš„æ•°æ®ä¸Šè¿­ä»£æ•°è½®ã€‚

















## å¤§è¯­è¨€æ¨¡å‹

### 1. TransformeråŸºç¡€

#### 1.1 åŸå‘é‡è¦ä¹˜ä»¥ä¸€ä¸ªçŸ©é˜µæ‰èƒ½å¾—åˆ°æŸ¥è¯¢(query)

è¿™æ ·æ‰èƒ½å¾—åˆ°åŒ…å«ä¸€å®šï¼ˆæ³¨æ„æ˜¯ä¸€å®šï¼‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å‘é‡ï¼Œå®è´¨æ˜¯å°†åµŒå…¥å‘é‡æ˜ å°„åˆ°ç›¸åº”çš„ä½ç»´ç©ºé—´



ä¸‹é¢è¿™å¼ å›¾æ‰æ˜¯éƒ½æ•´åˆäº†å‰é¢çš„ä¿¡æ¯ï¼ˆå›¾çš„å·¦è¾¹Væ˜¯ä¹˜ä»¥è¯åµŒå…¥çš„valueï¼‰

![image-20250209154740877](../AppData/Roaming/Typora/typora-user-images/image-20250209154740877.png)







#### 1.2 æ¯ç§ä¸åŒçš„ä¸Šä¸‹æ–‡æ›´æ–°æ–¹å¼ï¼Œé”®çŸ©é˜µå’ŒæŸ¥è¯¢çŸ©é˜µå‚æ•°éƒ½ä¼šå˜ï¼Œ

å€¼çŸ©é˜µä¹Ÿä¼šå› åµŒå…¥å€¼æ›´æ–°å€¼è€Œæ”¹å˜



![image-20250209162531504](../AppData/Roaming/Typora/typora-user-images/image-20250209162531504.png)



#### 1.3 nä¸ªæ³¨æ„å¤´æ„å‘³ç€nä¸ªq,k,vçŸ©é˜µ

#### 1.4 å¤šå¤´è®­ç»ƒ

å¤šåŠ å‡ ä¸ªå¤´æ›´ç²¾ç¡®ï¼ˆå°±å¤šåŠ å‡ ä¸ªdeltaï¼‰

![image-20250209162936158](../AppData/Roaming/Typora/typora-user-images/image-20250209162936158.png)



#### 1.5 æ·±å±‚ç†è§£

![image-20250209163459471](../AppData/Roaming/Typora/typora-user-images/image-20250209163459471.png)





















































# å¤§æ¨¡å‹åº”ç”¨

## 1. åŸºç¡€

### 1.1 è‡ªå›å½’æ¨¡å‹

#### è§£é‡Š

åœ¨è®­ç»ƒæ—¶ï¼Œæ¨¡å‹åœ¨é¢„æµ‹æŸä¸ªä½ç½®çš„è¯æ—¶ï¼Œ**åªèƒ½çœ‹åˆ°è¿™ä¸ªè¯ä¹‹å‰çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆä¸Šæ–‡ï¼‰**ï¼Œè€Œä¸èƒ½â€œå·çœ‹â€æœªæ¥çš„è¯ã€‚è¿™ä¸ªç‰¹æ€§å°±å« **â€œè‡ªå›å½’â€**ã€‚

#### æ“ä½œ

GPTæ˜¯ï¼š

1. æ¥å—æç¤ºè¯
2. é¢„æµ‹å¹¶æ·»åŠ ç¬¬ä¸€ä¸ªæ–°token
3. **æŠŠæç¤ºè¯+ç¬¬ä¸€ä¸ªtokenä¸€èµ·è¾“å…¥**ï¼Œé¢„æµ‹ç¬¬äºŒä¸ªæ–°token
4. **æŠŠæç¤ºè¯+å‰ä¸¤ä¸ªtokenä¸€èµ·è¾“å…¥**ï¼Œé¢„æµ‹ç¬¬ä¸‰ä¸ªæ–°token
5. å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°ç”Ÿæˆç»“æŸ

##### **å…³é”®æŠ€æœ¯ç»†èŠ‚**

â€‹      1.**KVç¼“å­˜ï¼ˆKey-Value Cacheï¼‰**ï¼šå®é™…å®ç°ä¸­ï¼Œä¸ºæå‡æ•ˆç‡ï¼Œä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°è®¡ç®—æ•´ä¸ªåºåˆ—ã€‚

- ç¬¬ä¸€æ¬¡è®¡ç®—æ—¶ï¼Œä¼šä¸º`["ä¸­å›½", "çš„", "é¦–éƒ½", "æ˜¯"]`ç”ŸæˆKeyå’ŒValueå‘é‡å¹¶ç¼“å­˜ã€‚

- ç”Ÿæˆ`"åŒ—äº¬"`æ—¶ï¼Œåªéœ€è®¡ç®—`"åŒ—äº¬"`çš„Key/Valueï¼Œå¹¶ä¸ç¼“å­˜çš„ç»“åˆã€‚

- ç”Ÿæˆ`"ã€‚"`æ—¶ï¼Œåªéœ€è®¡ç®—`"ã€‚"`çš„Key/Valueã€‚

- **é€»è¾‘ä¸Š**æ˜¯æ¯æ¬¡éƒ½è¾“å…¥å®Œæ•´åºåˆ—ï¼Œ**ç‰©ç†ä¸Š**åªè®¡ç®—æ–°tokenã€‚

  

  2.**ä¸ºä»€ä¹ˆéœ€è¦æ•´ä¸ªå†å²ä¸Šä¸‹æ–‡ï¼Ÿ**

- å› ä¸ºè¯­è¨€æœ‰**é•¿è·ç¦»ä¾èµ–**ã€‚æ¯”å¦‚ç”Ÿæˆç¬¬20ä¸ªè¯æ—¶ï¼Œå¯èƒ½ä¾èµ–äºç¬¬2ä¸ªè¯ã€‚
- Transformerçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ç†è®ºä¸Šå¯ä»¥çœ‹åˆ°åºåˆ—ä¸­çš„æ‰€æœ‰ä½ç½®ã€‚
- å¦‚æœæ²¡æœ‰æ•´ä¸ªå†å²ï¼Œæ¨¡å‹å°±åƒå¤±å¿†ä¸€æ ·ï¼Œæ— æ³•ä¿æŒä¸€è‡´æ€§ã€‚



#### GPTæ˜¯è‡ªç›‘ç£æ¨¡å‹

#### å¤§æ•°æ®é›†èµ·ä½œç”¨åŸç†

è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„ä»»åŠ¡ï¼Œå½“æ•°æ®é‡ï¼ˆæ•´ä¸ªäº’è”ç½‘ï¼‰å’Œæ¨¡å‹è§„æ¨¡ï¼ˆåƒäº¿çº§å‚æ•°ï¼‰è¾¾åˆ°ä¸´ç•Œç‚¹åï¼Œä¼šäº§ç”Ÿè´¨å˜ï¼Œå³ **â€œæ¶Œç°èƒ½åŠ›â€**ã€‚







### 1.2 ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹

#### 1. RNN

##### **RNNçš„åŸºæœ¬åŸç†ï¼šé€šè¿‡â€œè®°å¿†â€é—´æ¥ä¼ é€’ä¿¡æ¯**

RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼‰çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**æ¯ä¸ªæ—¶é—´æ­¥åªèƒ½çœ‹åˆ°å½“å‰è¾“å…¥å’Œä¸Šä¸€ä¸ªæ—¶é—´æ­¥çš„â€œè®°å¿†â€ï¼ˆéšè—çŠ¶æ€ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªâ€œè®°å¿†â€é“¾å¼ä¼ é€’ä¿¡æ¯ã€‚**

###### **å¯è§†åŒ–å¯¹æ¯”**

**Transformerï¼ˆè‡ªæ³¨æ„åŠ›ï¼‰ï¼š**

text

```
è¾“å…¥: [è¯1, è¯2, è¯3, è¯4, è¯5]
å¤„ç†è¯5æ—¶: å¯ä»¥ç›´æ¥çœ‹åˆ°[è¯1, è¯2, è¯3, è¯4, è¯5]çš„å…¨éƒ¨
â†’ å»ºç«‹ä»»æ„ä¸¤ä¸ªè¯çš„ç›´æ¥è¿æ¥
```



**RNNï¼ˆå•å‘ï¼‰ï¼š**

text

```
æ—¶é—´çº¿: t1      t2      t3      t4      t5
è¾“å…¥:   è¯1  â†’  è¯2  â†’  è¯3  â†’  è¯4  â†’  è¯5
è®°å¿†:   h1  â†’   h2  â†’   h3  â†’   h4  â†’   h5
            â†—      â†—      â†—      â†—
ä¾èµ–:    åªä¾èµ–h1  åªä¾èµ–h2  åªä¾èµ–h3  åªä¾èµ–h4
```



**å…³é”®**ï¼šåœ¨t5æ—¶åˆ»ï¼ŒRNNåªèƒ½ç›´æ¥çœ‹åˆ°**è¯5**å’Œ**h4**ã€‚h4æ˜¯åŒ…å«äº†è¯1-è¯4ä¿¡æ¯çš„â€œæ‘˜è¦â€ï¼Œä½†ä¸æ˜¯åŸå§‹ä¿¡æ¯æœ¬èº«ã€‚



























### 1.3 **å¤§æ¨¡å‹å­¦ä¹ çš„æ˜¯ç»„åˆè§„å¾‹**

æœ‰é™æ ·æœ¬ä¸­åŒ…å«äº†å¤§é‡å¯é‡ç”¨çš„â€œæ¨¡å—â€ï¼Œæ¨¡å‹å­¦ä¼šè¿™äº›æ¨¡å—åå¯ä»¥ç»„åˆå‡ºæ–°çš„å†…å®¹ã€‚

æ¯”å¦‚ï¼š

- A å­¦ä¼šäº†â€œåšé¥­çš„æ­¥éª¤â€
- B å­¦ä¼šäº†â€œé¸¡è›‹æ€ä¹ˆå¤„ç†â€
- C å­¦ä¼šäº†â€œç•ªèŒ„çš„ç‰¹æ€§â€

é‚£ä¹ˆæ¨¡å‹å¯ä»¥ï¼š

â†’ ç»„åˆ A+B+C ç”Ÿæˆæ–°èœè°±

å“ªæ€•è®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°è¿‡è¿™ä¸ªå®Œæ•´èœè°±ã€‚

è¿™å«**ç»„åˆæ³›åŒ–ï¼ˆcompositional generalizationï¼‰**ã€‚



















# ç§‘ç ”æ„Ÿæ‚Ÿ

## 1. ç§‘ç ”æ˜¯å¾ªåºæ¸è¿›çš„

**è¿™æ˜¯clipæ¨¡å‹ä¹‹å‰çš„å·¥ä½œ**

20 å¤šå¹´å‰ï¼ŒMori ç­‰äºº (1999) æ¢ç´¢äº†é€šè¿‡è®­ç»ƒä¸€ä¸ªæ¨¡å‹æ¥é¢„æµ‹ä¸å›¾åƒé…å¯¹çš„æ–‡æœ¬æ–‡æ¡£ä¸­çš„åè¯å’Œå½¢å®¹è¯ï¼Œä»è€Œæ”¹è¿›åŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢ã€‚Quattoni ç­‰äºº (2007) è¯æ˜äº†é€šè¿‡åœ¨å­¦ä¹ ç”¨äºé¢„æµ‹ä¸å›¾åƒç›¸å…³çš„æ ‡é¢˜ä¸­å•è¯çš„åˆ†ç±»å™¨æƒé‡ç©ºé—´ä¸­è¿›è¡Œæµå½¢å­¦ä¹ ï¼Œå¯ä»¥å­¦ä¹ åˆ°æ•°æ®æ•ˆç‡æ›´é«˜çš„å›¾åƒè¡¨ç¤ºã€‚











